/*! For license information please see 589.min.js.LICENSE.txt */
(self.webpackChunkshin_portfolio=self.webpackChunkshin_portfolio||[]).push([[589],{230:(t,e,i)=>{"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function n(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function o(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function h(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(Object(i),!0).forEach((function(e){a(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}function d(t,e){return d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},d(t,e)}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s=c(t);if(e){var r=c(this).constructor;i=Reflect.construct(s,arguments,r)}else i=s.apply(this,arguments);return function(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?u(t):e}(this,i)}}function m(t,e,i){return m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var s=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(s){var r=Object.getOwnPropertyDescriptor(s,e);return r.get?r.get.call(i):r.value}},m(t,e,i||t)}function g(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],s=!0,r=!1,n=void 0;try{for(var a,o=t[Symbol.iterator]();!(s=(a=o.next()).done)&&(i.push(a.value),!e||i.length!==e);s=!0);}catch(t){r=!0,n=t}finally{try{s||null==o.return||o.return()}finally{if(r)throw n}}return i}(t,e)||_(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t){return function(t){if(Array.isArray(t))return y(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||_(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(t,e){if(t){if("string"==typeof t)return y(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?y(t,e):void 0}}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}i.d(e,{ZP:()=>ut});var v={el:document,name:"scroll",offset:[0,0],repeat:!1,smooth:!1,initPosition:{x:0,y:0},direction:"vertical",gestureDirection:"vertical",reloadOnContextChange:!1,lerp:.1,class:"is-inview",scrollbarContainer:!1,scrollbarClass:"c-scrollbar",scrollingClass:"has-scroll-scrolling",draggingClass:"has-scroll-dragging",smoothClass:"has-scroll-smooth",initClass:"has-scroll-init",getSpeed:!1,getDirection:!1,scrollFromAnywhere:!1,multiplier:1,firefoxMultiplier:50,touchMultiplier:2,resetNativeScroll:!0,tablet:{smooth:!1,direction:"vertical",gestureDirection:"vertical",breakpoint:1024},smartphone:{smooth:!1,direction:"vertical",gestureDirection:"vertical"}},x=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this,t),Object.assign(this,v,e),this.smartphone=v.smartphone,e.smartphone&&Object.assign(this.smartphone,e.smartphone),this.tablet=v.tablet,e.tablet&&Object.assign(this.tablet,e.tablet),this.namespace="locomotive",this.html=document.documentElement,this.windowHeight=window.innerHeight,this.windowWidth=window.innerWidth,this.windowMiddle={x:this.windowWidth/2,y:this.windowHeight/2},this.els={},this.currentElements={},this.listeners={},this.hasScrollTicking=!1,this.hasCallEventSet=!1,this.checkScroll=this.checkScroll.bind(this),this.checkResize=this.checkResize.bind(this),this.checkEvent=this.checkEvent.bind(this),this.instance={scroll:{x:0,y:0},limit:{x:this.html.offsetWidth,y:this.html.offsetHeight},currentElements:this.currentElements},this.isMobile?this.isTablet?this.context="tablet":this.context="smartphone":this.context="desktop",this.isMobile&&(this.direction=this[this.context].direction),"horizontal"===this.direction?this.directionAxis="x":this.directionAxis="y",this.getDirection&&(this.instance.direction=null),this.getDirection&&(this.instance.speed=0),this.html.classList.add(this.initClass),window.addEventListener("resize",this.checkResize,!1)}return n(t,[{key:"init",value:function(){this.initEvents()}},{key:"checkScroll",value:function(){this.dispatchScroll()}},{key:"checkResize",value:function(){var t=this;this.resizeTick||(this.resizeTick=!0,requestAnimationFrame((function(){t.resize(),t.resizeTick=!1})))}},{key:"resize",value:function(){}},{key:"checkContext",value:function(){if(this.reloadOnContextChange){this.isMobile=/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1||this.windowWidth<this.tablet.breakpoint,this.isTablet=this.isMobile&&this.windowWidth>=this.tablet.breakpoint;var t=this.context;if(this.isMobile?this.isTablet?this.context="tablet":this.context="smartphone":this.context="desktop",t!=this.context)("desktop"==t?this.smooth:this[t].smooth)!=("desktop"==this.context?this.smooth:this[this.context].smooth)&&window.location.reload()}}},{key:"initEvents",value:function(){var t=this;this.scrollToEls=this.el.querySelectorAll("[data-".concat(this.name,"-to]")),this.setScrollTo=this.setScrollTo.bind(this),this.scrollToEls.forEach((function(e){e.addEventListener("click",t.setScrollTo,!1)}))}},{key:"setScrollTo",value:function(t){t.preventDefault(),this.scrollTo(t.currentTarget.getAttribute("data-".concat(this.name,"-href"))||t.currentTarget.getAttribute("href"),{offset:t.currentTarget.getAttribute("data-".concat(this.name,"-offset"))})}},{key:"addElements",value:function(){}},{key:"detectElements",value:function(t){var e=this,i=this.instance.scroll.y,s=i+this.windowHeight,r=this.instance.scroll.x,n=r+this.windowWidth;Object.entries(this.els).forEach((function(a){var o=g(a,2),h=o[0],l=o[1];if(!l||l.inView&&!t||("horizontal"===e.direction?n>=l.left&&r<l.right&&e.setInView(l,h):s>=l.top&&i<l.bottom&&e.setInView(l,h)),l&&l.inView)if("horizontal"===e.direction){var c=l.right-l.left;l.progress=(e.instance.scroll.x-(l.left-e.windowWidth))/(c+e.windowWidth),(n<l.left||r>l.right)&&e.setOutOfView(l,h)}else{var d=l.bottom-l.top;l.progress=(e.instance.scroll.y-(l.top-e.windowHeight))/(d+e.windowHeight),(s<l.top||i>l.bottom)&&e.setOutOfView(l,h)}})),this.hasScrollTicking=!1}},{key:"setInView",value:function(t,e){this.els[e].inView=!0,t.el.classList.add(t.class),this.currentElements[e]=t,t.call&&this.hasCallEventSet&&(this.dispatchCall(t,"enter"),t.repeat||(this.els[e].call=!1))}},{key:"setOutOfView",value:function(t,e){var i=this;this.els[e].inView=!1,Object.keys(this.currentElements).forEach((function(t){t===e&&delete i.currentElements[t]})),t.call&&this.hasCallEventSet&&this.dispatchCall(t,"exit"),t.repeat&&t.el.classList.remove(t.class)}},{key:"dispatchCall",value:function(t,e){this.callWay=e,this.callValue=t.call.split(",").map((function(t){return t.trim()})),this.callObj=t,1==this.callValue.length&&(this.callValue=this.callValue[0]);var i=new Event(this.namespace+"call");this.el.dispatchEvent(i)}},{key:"dispatchScroll",value:function(){var t=new Event(this.namespace+"scroll");this.el.dispatchEvent(t)}},{key:"setEvents",value:function(t,e){this.listeners[t]||(this.listeners[t]=[]);var i=this.listeners[t];i.push(e),1===i.length&&this.el.addEventListener(this.namespace+t,this.checkEvent,!1),"call"===t&&(this.hasCallEventSet=!0,this.detectElements(!0))}},{key:"unsetEvents",value:function(t,e){if(this.listeners[t]){var i=this.listeners[t],s=i.indexOf(e);s<0||(i.splice(s,1),0===i.index&&this.el.removeEventListener(this.namespace+t,this.checkEvent,!1))}}},{key:"checkEvent",value:function(t){var e=this,i=t.type.replace(this.namespace,""),s=this.listeners[i];s&&0!==s.length&&s.forEach((function(t){switch(i){case"scroll":return t(e.instance);case"call":return t(e.callValue,e.callWay,e.callObj);default:return t()}}))}},{key:"startScroll",value:function(){}},{key:"stopScroll",value:function(){}},{key:"setScroll",value:function(t,e){this.instance.scroll={x:0,y:0}}},{key:"destroy",value:function(){var t=this;window.removeEventListener("resize",this.checkResize,!1),Object.keys(this.listeners).forEach((function(e){t.el.removeEventListener(t.namespace+e,t.checkEvent,!1)})),this.listeners={},this.scrollToEls.forEach((function(e){e.removeEventListener("click",t.setScrollTo,!1)})),this.html.classList.remove(this.initClass)}}]),t}(),b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:{};function w(t,e){return t(e={exports:{}},e.exports),e.exports}var S=w((function(t,e){t.exports={polyfill:function(){var t=window,e=document;if(!("scrollBehavior"in e.documentElement.style)||!0===t.__forceSmoothScrollPolyfill__){var i,s=t.HTMLElement||t.Element,r=468,n={scroll:t.scroll||t.scrollTo,scrollBy:t.scrollBy,elementScroll:s.prototype.scroll||h,scrollIntoView:s.prototype.scrollIntoView},a=t.performance&&t.performance.now?t.performance.now.bind(t.performance):Date.now,o=(i=t.navigator.userAgent,new RegExp(["MSIE ","Trident/","Edge/"].join("|")).test(i)?1:0);t.scroll=t.scrollTo=function(){void 0!==arguments[0]&&(!0!==l(arguments[0])?m.call(t,e.body,void 0!==arguments[0].left?~~arguments[0].left:t.scrollX||t.pageXOffset,void 0!==arguments[0].top?~~arguments[0].top:t.scrollY||t.pageYOffset):n.scroll.call(t,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:t.scrollX||t.pageXOffset,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:t.scrollY||t.pageYOffset))},t.scrollBy=function(){void 0!==arguments[0]&&(l(arguments[0])?n.scrollBy.call(t,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:0,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:0):m.call(t,e.body,~~arguments[0].left+(t.scrollX||t.pageXOffset),~~arguments[0].top+(t.scrollY||t.pageYOffset)))},s.prototype.scroll=s.prototype.scrollTo=function(){if(void 0!==arguments[0])if(!0!==l(arguments[0])){var t=arguments[0].left,e=arguments[0].top;m.call(this,this,void 0===t?this.scrollLeft:~~t,void 0===e?this.scrollTop:~~e)}else{if("number"==typeof arguments[0]&&void 0===arguments[1])throw new SyntaxError("Value could not be converted");n.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left:"object"!=typeof arguments[0]?~~arguments[0]:this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top:void 0!==arguments[1]?~~arguments[1]:this.scrollTop)}},s.prototype.scrollBy=function(){void 0!==arguments[0]&&(!0!==l(arguments[0])?this.scroll({left:~~arguments[0].left+this.scrollLeft,top:~~arguments[0].top+this.scrollTop,behavior:arguments[0].behavior}):n.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left+this.scrollLeft:~~arguments[0]+this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top+this.scrollTop:~~arguments[1]+this.scrollTop))},s.prototype.scrollIntoView=function(){if(!0!==l(arguments[0])){var i=function(t){for(;t!==e.body&&!1===u(t);)t=t.parentNode||t.host;return t}(this),s=i.getBoundingClientRect(),r=this.getBoundingClientRect();i!==e.body?(m.call(this,i,i.scrollLeft+r.left-s.left,i.scrollTop+r.top-s.top),"fixed"!==t.getComputedStyle(i).position&&t.scrollBy({left:s.left,top:s.top,behavior:"smooth"})):t.scrollBy({left:r.left,top:r.top,behavior:"smooth"})}else n.scrollIntoView.call(this,void 0===arguments[0]||arguments[0])}}function h(t,e){this.scrollLeft=t,this.scrollTop=e}function l(t){if(null===t||"object"!=typeof t||void 0===t.behavior||"auto"===t.behavior||"instant"===t.behavior)return!0;if("object"==typeof t&&"smooth"===t.behavior)return!1;throw new TypeError("behavior member of ScrollOptions "+t.behavior+" is not a valid value for enumeration ScrollBehavior.")}function c(t,e){return"Y"===e?t.clientHeight+o<t.scrollHeight:"X"===e?t.clientWidth+o<t.scrollWidth:void 0}function d(e,i){var s=t.getComputedStyle(e,null)["overflow"+i];return"auto"===s||"scroll"===s}function u(t){var e=c(t,"Y")&&d(t,"Y"),i=c(t,"X")&&d(t,"X");return e||i}function p(e){var i,s,n,o,h=(a()-e.startTime)/r;o=h=h>1?1:h,i=.5*(1-Math.cos(Math.PI*o)),s=e.startX+(e.x-e.startX)*i,n=e.startY+(e.y-e.startY)*i,e.method.call(e.scrollable,s,n),s===e.x&&n===e.y||t.requestAnimationFrame(p.bind(t,e))}function m(i,s,r){var o,l,c,d,u=a();i===e.body?(o=t,l=t.scrollX||t.pageXOffset,c=t.scrollY||t.pageYOffset,d=n.scroll):(o=i,l=i.scrollLeft,c=i.scrollTop,d=h),p({scrollable:o,method:d,startTime:u,startX:l,startY:c,x:s,y:r})}}}})),T=(S.polyfill,function(t){l(i,t);var e=p(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,i),(t=e.call(this,r)).resetNativeScroll&&(history.scrollRestoration&&(history.scrollRestoration="manual"),window.scrollTo(0,0)),window.addEventListener("scroll",t.checkScroll,!1),void 0===window.smoothscrollPolyfill&&(window.smoothscrollPolyfill=S,window.smoothscrollPolyfill.polyfill()),t}return n(i,[{key:"init",value:function(){this.instance.scroll.y=window.pageYOffset,this.addElements(),this.detectElements(),m(c(i.prototype),"init",this).call(this)}},{key:"checkScroll",value:function(){var t=this;m(c(i.prototype),"checkScroll",this).call(this),this.getDirection&&this.addDirection(),this.getSpeed&&(this.addSpeed(),this.speedTs=Date.now()),this.instance.scroll.y=window.pageYOffset,Object.entries(this.els).length&&(this.hasScrollTicking||(requestAnimationFrame((function(){t.detectElements()})),this.hasScrollTicking=!0))}},{key:"addDirection",value:function(){window.pageYOffset>this.instance.scroll.y?"down"!==this.instance.direction&&(this.instance.direction="down"):window.pageYOffset<this.instance.scroll.y&&"up"!==this.instance.direction&&(this.instance.direction="up")}},{key:"addSpeed",value:function(){window.pageYOffset!=this.instance.scroll.y?this.instance.speed=(window.pageYOffset-this.instance.scroll.y)/Math.max(1,Date.now()-this.speedTs):this.instance.speed=0}},{key:"resize",value:function(){Object.entries(this.els).length&&(this.windowHeight=window.innerHeight,this.updateElements())}},{key:"addElements",value:function(){var t=this;this.els={},this.el.querySelectorAll("[data-"+this.name+"]").forEach((function(e,i){e.getBoundingClientRect();var s,r,n,a=e.dataset[t.name+"Class"]||t.class,o="string"==typeof e.dataset[t.name+"Id"]?e.dataset[t.name+"Id"]:i,h="string"==typeof e.dataset[t.name+"Offset"]?e.dataset[t.name+"Offset"].split(","):t.offset,l=e.dataset[t.name+"Repeat"],c=e.dataset[t.name+"Call"],d=e.dataset[t.name+"Target"],u=(n=void 0!==d?document.querySelector("".concat(d)):e).getBoundingClientRect();s=u.top+t.instance.scroll.y,r=u.left+t.instance.scroll.x;var p=s+n.offsetHeight,m=r+n.offsetWidth;l="false"!=l&&(null!=l||t.repeat);var g=t.getRelativeOffset(h),f={el:e,targetEl:n,id:o,class:a,top:s+=g[0],bottom:p-=g[1],left:r,right:m,offset:h,progress:0,repeat:l,inView:!1,call:c};t.els[o]=f,e.classList.contains(a)&&t.setInView(t.els[o],o)}))}},{key:"updateElements",value:function(){var t=this;Object.entries(this.els).forEach((function(e){var i=g(e,2),s=i[0],r=i[1],n=r.targetEl.getBoundingClientRect().top+t.instance.scroll.y,a=n+r.targetEl.offsetHeight,o=t.getRelativeOffset(r.offset);t.els[s].top=n+o[0],t.els[s].bottom=a-o[1]})),this.hasScrollTicking=!1}},{key:"getRelativeOffset",value:function(t){var e=[0,0];if(t)for(var i=0;i<t.length;i++)"string"==typeof t[i]?t[i].includes("%")?e[i]=parseInt(t[i].replace("%","")*this.windowHeight/100):e[i]=parseInt(t[i]):e[i]=t[i];return e}},{key:"scrollTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=parseInt(e.offset)||0,s=!!e.callback&&e.callback;if("string"==typeof t){if("top"===t)t=this.html;else if("bottom"===t)t=this.html.offsetHeight-window.innerHeight;else if(!(t=document.querySelector(t)))return}else if("number"==typeof t)t=parseInt(t);else if(!t||!t.tagName)return;i="number"!=typeof t?t.getBoundingClientRect().top+i+this.instance.scroll.y:t+i;var r=function(){return parseInt(window.pageYOffset)===parseInt(i)};if(s){if(r())return void s();window.addEventListener("scroll",(function t(){r()&&(window.removeEventListener("scroll",t),s())}))}window.scrollTo({top:i,behavior:0===e.duration?"auto":"smooth"})}},{key:"update",value:function(){this.addElements(),this.detectElements()}},{key:"destroy",value:function(){m(c(i.prototype),"destroy",this).call(this),window.removeEventListener("scroll",this.checkScroll,!1)}}]),i}(x)),R=Object.getOwnPropertySymbols,E=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var k=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach((function(t){s[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},s)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var i,s,r=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),n=1;n<arguments.length;n++){for(var a in i=Object(arguments[n]))E.call(i,a)&&(r[a]=i[a]);if(R){s=R(i);for(var o=0;o<s.length;o++)P.call(i,s[o])&&(r[s[o]]=i[s[o]])}}return r};function C(){}C.prototype={on:function(t,e,i){var s=this.e||(this.e={});return(s[t]||(s[t]=[])).push({fn:e,ctx:i}),this},once:function(t,e,i){var s=this;function r(){s.off(t,r),e.apply(i,arguments)}return r._=e,this.on(t,r,i)},emit:function(t){for(var e=[].slice.call(arguments,1),i=((this.e||(this.e={}))[t]||[]).slice(),s=0,r=i.length;s<r;s++)i[s].fn.apply(i[s].ctx,e);return this},off:function(t,e){var i=this.e||(this.e={}),s=i[t],r=[];if(s&&e)for(var n=0,a=s.length;n<a;n++)s[n].fn!==e&&s[n].fn._!==e&&r.push(s[n]);return r.length?i[t]=r:delete i[t],this}};var A=C,M=w((function(t,e){(function(){(null!==e?e:this).Lethargy=function(){function t(t,e,i,s){this.stability=null!=t?Math.abs(t):8,this.sensitivity=null!=e?1+Math.abs(e):100,this.tolerance=null!=i?1+Math.abs(i):1.1,this.delay=null!=s?s:150,this.lastUpDeltas=function(){var t,e,i;for(i=[],t=1,e=2*this.stability;1<=e?t<=e:t>=e;1<=e?t++:t--)i.push(null);return i}.call(this),this.lastDownDeltas=function(){var t,e,i;for(i=[],t=1,e=2*this.stability;1<=e?t<=e:t>=e;1<=e?t++:t--)i.push(null);return i}.call(this),this.deltasTimestamp=function(){var t,e,i;for(i=[],t=1,e=2*this.stability;1<=e?t<=e:t>=e;1<=e?t++:t--)i.push(null);return i}.call(this)}return t.prototype.check=function(t){var e;return null!=(t=t.originalEvent||t).wheelDelta?e=t.wheelDelta:null!=t.deltaY?e=-40*t.deltaY:null==t.detail&&0!==t.detail||(e=-40*t.detail),this.deltasTimestamp.push(Date.now()),this.deltasTimestamp.shift(),e>0?(this.lastUpDeltas.push(e),this.lastUpDeltas.shift(),this.isInertia(1)):(this.lastDownDeltas.push(e),this.lastDownDeltas.shift(),this.isInertia(-1))},t.prototype.isInertia=function(t){var e,i,s,r,n,a,o;return null===(e=-1===t?this.lastDownDeltas:this.lastUpDeltas)[0]?t:!(this.deltasTimestamp[2*this.stability-2]+this.delay>Date.now()&&e[0]===e[2*this.stability-1])&&(s=e.slice(0,this.stability),i=e.slice(this.stability,2*this.stability),o=s.reduce((function(t,e){return t+e})),n=i.reduce((function(t,e){return t+e})),a=o/s.length,r=n/i.length,Math.abs(a)<Math.abs(r*this.tolerance)&&this.sensitivity<Math.abs(r)&&t)},t.prototype.showLastUpDeltas=function(){return this.lastUpDeltas},t.prototype.showLastDownDeltas=function(){return this.lastDownDeltas},t}()}).call(b)})),O={hasWheelEvent:"onwheel"in document,hasMouseWheelEvent:"onmousewheel"in document,hasTouch:"ontouchstart"in window||window.TouchEvent||window.DocumentTouch&&document instanceof DocumentTouch,hasTouchWin:navigator.msMaxTouchPoints&&navigator.msMaxTouchPoints>1,hasPointer:!!window.navigator.msPointerEnabled,hasKeyDown:"onkeydown"in document,isFirefox:navigator.userAgent.indexOf("Firefox")>-1},L=Object.prototype.toString,D=Object.prototype.hasOwnProperty;function F(t,e){return function(){return t.apply(e,arguments)}}var z=M.Lethargy,I="virtualscroll",U=H,V=37,B=38,W=39,N=40,j=32;function H(t){!function(t){if(t){var e=Array.prototype.slice.call(arguments,1);if(0===e.length)for(var i in t)D.call(t,i)&&"function"==typeof t[i]&&"[object Function]"==L.call(t[i])&&e.push(i);for(var s=0;s<e.length;s++){var r=e[s];t[r]=F(t[r],t)}}}(this,"_onWheel","_onMouseWheel","_onTouchStart","_onTouchMove","_onKeyDown"),this.el=window,t&&t.el&&(this.el=t.el,delete t.el),this.options=k({mouseMultiplier:1,touchMultiplier:2,firefoxMultiplier:15,keyStep:120,preventTouch:!1,unpreventTouchClass:"vs-touchmove-allowed",limitInertia:!1,useKeyboard:!0,useTouch:!0},t),this.options.limitInertia&&(this._lethargy=new z),this._emitter=new A,this._event={y:0,x:0,deltaX:0,deltaY:0},this.touchStartX=null,this.touchStartY=null,this.bodyTouchAction=null,void 0!==this.options.passive&&(this.listenerOptions={passive:this.options.passive})}function X(t,e,i){return(1-i)*t+i*e}function Y(t){var e={};if(window.getComputedStyle){var i=getComputedStyle(t),s=i.transform||i.webkitTransform||i.mozTransform,r=s.match(/^matrix3d\((.+)\)$/);return r?(e.x=r?parseFloat(r[1].split(", ")[12]):0,e.y=r?parseFloat(r[1].split(", ")[13]):0):(r=s.match(/^matrix\((.+)\)$/),e.x=r?parseFloat(r[1].split(", ")[4]):0,e.y=r?parseFloat(r[1].split(", ")[5]):0),e}}function G(t){for(var e=[];t&&t!==document;t=t.parentNode)e.push(t);return e}H.prototype._notify=function(t){var e=this._event;e.x+=e.deltaX,e.y+=e.deltaY,this._emitter.emit(I,{x:e.x,y:e.y,deltaX:e.deltaX,deltaY:e.deltaY,originalEvent:t})},H.prototype._onWheel=function(t){var e=this.options;if(!this._lethargy||!1!==this._lethargy.check(t)){var i=this._event;i.deltaX=t.wheelDeltaX||-1*t.deltaX,i.deltaY=t.wheelDeltaY||-1*t.deltaY,O.isFirefox&&1==t.deltaMode&&(i.deltaX*=e.firefoxMultiplier,i.deltaY*=e.firefoxMultiplier),i.deltaX*=e.mouseMultiplier,i.deltaY*=e.mouseMultiplier,this._notify(t)}},H.prototype._onMouseWheel=function(t){if(!this.options.limitInertia||!1!==this._lethargy.check(t)){var e=this._event;e.deltaX=t.wheelDeltaX?t.wheelDeltaX:0,e.deltaY=t.wheelDeltaY?t.wheelDeltaY:t.wheelDelta,this._notify(t)}},H.prototype._onTouchStart=function(t){var e=t.targetTouches?t.targetTouches[0]:t;this.touchStartX=e.pageX,this.touchStartY=e.pageY},H.prototype._onTouchMove=function(t){var e=this.options;e.preventTouch&&!t.target.classList.contains(e.unpreventTouchClass)&&t.preventDefault();var i=this._event,s=t.targetTouches?t.targetTouches[0]:t;i.deltaX=(s.pageX-this.touchStartX)*e.touchMultiplier,i.deltaY=(s.pageY-this.touchStartY)*e.touchMultiplier,this.touchStartX=s.pageX,this.touchStartY=s.pageY,this._notify(t)},H.prototype._onKeyDown=function(t){var e=this._event;e.deltaX=e.deltaY=0;var i=window.innerHeight-40;switch(t.keyCode){case V:case B:e.deltaY=this.options.keyStep;break;case W:case N:e.deltaY=-this.options.keyStep;break;case t.shiftKey:e.deltaY=i;break;case j:e.deltaY=-i;break;default:return}this._notify(t)},H.prototype._bind=function(){O.hasWheelEvent&&this.el.addEventListener("wheel",this._onWheel,this.listenerOptions),O.hasMouseWheelEvent&&this.el.addEventListener("mousewheel",this._onMouseWheel,this.listenerOptions),O.hasTouch&&this.options.useTouch&&(this.el.addEventListener("touchstart",this._onTouchStart,this.listenerOptions),this.el.addEventListener("touchmove",this._onTouchMove,this.listenerOptions)),O.hasPointer&&O.hasTouchWin&&(this.bodyTouchAction=document.body.style.msTouchAction,document.body.style.msTouchAction="none",this.el.addEventListener("MSPointerDown",this._onTouchStart,!0),this.el.addEventListener("MSPointerMove",this._onTouchMove,!0)),O.hasKeyDown&&this.options.useKeyboard&&document.addEventListener("keydown",this._onKeyDown)},H.prototype._unbind=function(){O.hasWheelEvent&&this.el.removeEventListener("wheel",this._onWheel),O.hasMouseWheelEvent&&this.el.removeEventListener("mousewheel",this._onMouseWheel),O.hasTouch&&(this.el.removeEventListener("touchstart",this._onTouchStart),this.el.removeEventListener("touchmove",this._onTouchMove)),O.hasPointer&&O.hasTouchWin&&(document.body.style.msTouchAction=this.bodyTouchAction,this.el.removeEventListener("MSPointerDown",this._onTouchStart,!0),this.el.removeEventListener("MSPointerMove",this._onTouchMove,!0)),O.hasKeyDown&&this.options.useKeyboard&&document.removeEventListener("keydown",this._onKeyDown)},H.prototype.on=function(t,e){this._emitter.on(I,t,e);var i=this._emitter.e;i&&i[I]&&1===i[I].length&&this._bind()},H.prototype.off=function(t,e){this._emitter.off(I,t,e);var i=this._emitter.e;(!i[I]||i[I].length<=0)&&this._unbind()},H.prototype.reset=function(){var t=this._event;t.x=0,t.y=0},H.prototype.destroy=function(){this._emitter.off(),this._unbind()};var q=.1,K="function"==typeof Float32Array;function Z(t,e){return 1-3*e+3*t}function Q(t,e){return 3*e-6*t}function $(t){return 3*t}function J(t,e,i){return((Z(e,i)*t+Q(e,i))*t+$(e))*t}function tt(t,e,i){return 3*Z(e,i)*t*t+2*Q(e,i)*t+$(e)}function et(t){return t}var it=function(t,e,i,s){if(!(0<=t&&t<=1&&0<=i&&i<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&i===s)return et;for(var r=K?new Float32Array(11):new Array(11),n=0;n<11;++n)r[n]=J(n*q,t,i);function a(e){for(var s=0,n=1;10!==n&&r[n]<=e;++n)s+=q;--n;var a=s+(e-r[n])/(r[n+1]-r[n])*q,o=tt(a,t,i);return o>=.001?function(t,e,i,s){for(var r=0;r<4;++r){var n=tt(e,i,s);if(0===n)return e;e-=(J(e,i,s)-t)/n}return e}(e,a,t,i):0===o?a:function(t,e,i,s,r){var n,a,o=0;do{(n=J(a=e+(i-e)/2,s,r)-t)>0?i=a:e=a}while(Math.abs(n)>1e-7&&++o<10);return a}(e,s,s+q,t,i)}return function(t){return 0===t?0:1===t?1:J(a(t),e,s)}},st=38,rt=40,nt=32,at=9,ot=33,ht=34,lt=36,ct=35,dt=function(t){l(i,t);var e=p(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s(this,i),history.scrollRestoration&&(history.scrollRestoration="manual"),window.scrollTo(0,0),(t=e.call(this,r)).inertia&&(t.lerp=.1*t.inertia),t.isScrolling=!1,t.isDraggingScrollbar=!1,t.isTicking=!1,t.hasScrollTicking=!1,t.parallaxElements={},t.stop=!1,t.scrollbarContainer=r.scrollbarContainer,t.checkKey=t.checkKey.bind(u(t)),window.addEventListener("keydown",t.checkKey,!1),t}return n(i,[{key:"init",value:function(){var t=this;this.html.classList.add(this.smoothClass),this.html.setAttribute("data-".concat(this.name,"-direction"),this.direction),this.instance=h({delta:{x:this.initPosition.x,y:this.initPosition.y},scroll:{x:this.initPosition.x,y:this.initPosition.y}},this.instance),this.vs=new U({el:this.scrollFromAnywhere?document:this.el,mouseMultiplier:navigator.platform.indexOf("Win")>-1?1:.4,firefoxMultiplier:this.firefoxMultiplier,touchMultiplier:this.touchMultiplier,useKeyboard:!1,passive:!0}),this.vs.on((function(e){t.stop||t.isDraggingScrollbar||requestAnimationFrame((function(){t.updateDelta(e),t.isScrolling||t.startScrolling()}))})),this.setScrollLimit(),this.initScrollBar(),this.addSections(),this.addElements(),this.checkScroll(!0),this.transformElements(!0,!0),m(c(i.prototype),"init",this).call(this)}},{key:"setScrollLimit",value:function(){if(this.instance.limit.y=this.el.offsetHeight-this.windowHeight,"horizontal"===this.direction){for(var t=0,e=this.el.children,i=0;i<e.length;i++)t+=e[i].offsetWidth;this.instance.limit.x=t-this.windowWidth}}},{key:"startScrolling",value:function(){this.startScrollTs=Date.now(),this.isScrolling=!0,this.checkScroll(),this.html.classList.add(this.scrollingClass)}},{key:"stopScrolling",value:function(){cancelAnimationFrame(this.checkScrollRaf),this.startScrollTs=void 0,this.scrollToRaf&&(cancelAnimationFrame(this.scrollToRaf),this.scrollToRaf=null),this.isScrolling=!1,this.instance.scroll.y=Math.round(this.instance.scroll.y),this.html.classList.remove(this.scrollingClass)}},{key:"checkKey",value:function(t){var e=this;if(this.stop)t.keyCode==at&&requestAnimationFrame((function(){e.html.scrollTop=0,document.body.scrollTop=0,e.html.scrollLeft=0,document.body.scrollLeft=0}));else{switch(t.keyCode){case at:requestAnimationFrame((function(){e.html.scrollTop=0,document.body.scrollTop=0,e.html.scrollLeft=0,document.body.scrollLeft=0,e.scrollTo(document.activeElement,{offset:-window.innerHeight/2})}));break;case st:this.isActiveElementScrollSensitive()&&(this.instance.delta[this.directionAxis]-=240);break;case rt:this.isActiveElementScrollSensitive()&&(this.instance.delta[this.directionAxis]+=240);break;case ot:this.instance.delta[this.directionAxis]-=window.innerHeight;break;case ht:this.instance.delta[this.directionAxis]+=window.innerHeight;break;case lt:this.instance.delta[this.directionAxis]-=this.instance.limit[this.directionAxis];break;case ct:this.instance.delta[this.directionAxis]+=this.instance.limit[this.directionAxis];break;case nt:this.isActiveElementScrollSensitive()&&(t.shiftKey?this.instance.delta[this.directionAxis]-=window.innerHeight:this.instance.delta[this.directionAxis]+=window.innerHeight);break;default:return}this.instance.delta[this.directionAxis]<0&&(this.instance.delta[this.directionAxis]=0),this.instance.delta[this.directionAxis]>this.instance.limit[this.directionAxis]&&(this.instance.delta[this.directionAxis]=this.instance.limit[this.directionAxis]),this.stopScrolling(),this.isScrolling=!0,this.checkScroll(),this.html.classList.add(this.scrollingClass)}}},{key:"isActiveElementScrollSensitive",value:function(){return!(document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||document.activeElement instanceof HTMLButtonElement||document.activeElement instanceof HTMLSelectElement)}},{key:"checkScroll",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e||this.isScrolling||this.isDraggingScrollbar){this.hasScrollTicking||(this.checkScrollRaf=requestAnimationFrame((function(){return t.checkScroll()})),this.hasScrollTicking=!0),this.updateScroll();var s=Math.abs(this.instance.delta[this.directionAxis]-this.instance.scroll[this.directionAxis]),r=Date.now()-this.startScrollTs;if(!this.animatingScroll&&r>100&&(s<.5&&0!=this.instance.delta[this.directionAxis]||s<.5&&0==this.instance.delta[this.directionAxis])&&this.stopScrolling(),Object.entries(this.sections).forEach((function(i){var s=g(i,2),r=(s[0],s[1]);r.persistent||t.instance.scroll[t.directionAxis]>r.offset[t.directionAxis]&&t.instance.scroll[t.directionAxis]<r.limit[t.directionAxis]?("horizontal"===t.direction?t.transform(r.el,-t.instance.scroll[t.directionAxis],0):t.transform(r.el,0,-t.instance.scroll[t.directionAxis]),r.inView||(r.inView=!0,r.el.style.opacity=1,r.el.style.pointerEvents="all",r.el.setAttribute("data-".concat(t.name,"-section-inview"),""))):((r.inView||e)&&(r.inView=!1,r.el.style.opacity=0,r.el.style.pointerEvents="none",r.el.removeAttribute("data-".concat(t.name,"-section-inview"))),t.transform(r.el,0,0))})),this.getDirection&&this.addDirection(),this.getSpeed&&(this.addSpeed(),this.speedTs=Date.now()),this.detectElements(),this.transformElements(),this.hasScrollbar){var n=this.instance.scroll[this.directionAxis]/this.instance.limit[this.directionAxis]*this.scrollBarLimit[this.directionAxis];"horizontal"===this.direction?this.transform(this.scrollbarThumb,n,0):this.transform(this.scrollbarThumb,0,n)}m(c(i.prototype),"checkScroll",this).call(this),this.hasScrollTicking=!1}}},{key:"resize",value:function(){this.windowHeight=window.innerHeight,this.windowWidth=window.innerWidth,this.checkContext(),this.windowMiddle={x:this.windowWidth/2,y:this.windowHeight/2},this.update()}},{key:"updateDelta",value:function(t){var e,i=this[this.context]&&this[this.context].gestureDirection?this[this.context].gestureDirection:this.gestureDirection;e="both"===i?t.deltaX+t.deltaY:"vertical"===i?t.deltaY:"horizontal"===i?t.deltaX:t.deltaY,this.instance.delta[this.directionAxis]-=e*this.multiplier,this.instance.delta[this.directionAxis]<0&&(this.instance.delta[this.directionAxis]=0),this.instance.delta[this.directionAxis]>this.instance.limit[this.directionAxis]&&(this.instance.delta[this.directionAxis]=this.instance.limit[this.directionAxis])}},{key:"updateScroll",value:function(t){this.isScrolling||this.isDraggingScrollbar?this.instance.scroll[this.directionAxis]=X(this.instance.scroll[this.directionAxis],this.instance.delta[this.directionAxis],this.lerp):this.instance.scroll[this.directionAxis]>this.instance.limit[this.directionAxis]?this.setScroll(this.instance.scroll[this.directionAxis],this.instance.limit[this.directionAxis]):this.instance.scroll.y<0?this.setScroll(this.instance.scroll[this.directionAxis],0):this.setScroll(this.instance.scroll[this.directionAxis],this.instance.delta[this.directionAxis])}},{key:"addDirection",value:function(){this.instance.delta.y>this.instance.scroll.y?"down"!==this.instance.direction&&(this.instance.direction="down"):this.instance.delta.y<this.instance.scroll.y&&"up"!==this.instance.direction&&(this.instance.direction="up"),this.instance.delta.x>this.instance.scroll.x?"right"!==this.instance.direction&&(this.instance.direction="right"):this.instance.delta.x<this.instance.scroll.x&&"left"!==this.instance.direction&&(this.instance.direction="left")}},{key:"addSpeed",value:function(){this.instance.delta[this.directionAxis]!=this.instance.scroll[this.directionAxis]?this.instance.speed=(this.instance.delta[this.directionAxis]-this.instance.scroll[this.directionAxis])/Math.max(1,Date.now()-this.speedTs):this.instance.speed=0}},{key:"initScrollBar",value:function(){if(this.scrollbar=document.createElement("span"),this.scrollbarThumb=document.createElement("span"),this.scrollbar.classList.add("".concat(this.scrollbarClass)),this.scrollbarThumb.classList.add("".concat(this.scrollbarClass,"_thumb")),this.scrollbar.append(this.scrollbarThumb),this.scrollbarContainer?this.scrollbarContainer.append(this.scrollbar):document.body.append(this.scrollbar),this.getScrollBar=this.getScrollBar.bind(this),this.releaseScrollBar=this.releaseScrollBar.bind(this),this.moveScrollBar=this.moveScrollBar.bind(this),this.scrollbarThumb.addEventListener("mousedown",this.getScrollBar),window.addEventListener("mouseup",this.releaseScrollBar),window.addEventListener("mousemove",this.moveScrollBar),this.hasScrollbar=!1,"horizontal"==this.direction){if(this.instance.limit.x+this.windowWidth<=this.windowWidth)return}else if(this.instance.limit.y+this.windowHeight<=this.windowHeight)return;this.hasScrollbar=!0,this.scrollbarBCR=this.scrollbar.getBoundingClientRect(),this.scrollbarHeight=this.scrollbarBCR.height,this.scrollbarWidth=this.scrollbarBCR.width,"horizontal"===this.direction?this.scrollbarThumb.style.width="".concat(this.scrollbarWidth*this.scrollbarWidth/(this.instance.limit.x+this.scrollbarWidth),"px"):this.scrollbarThumb.style.height="".concat(this.scrollbarHeight*this.scrollbarHeight/(this.instance.limit.y+this.scrollbarHeight),"px"),this.scrollbarThumbBCR=this.scrollbarThumb.getBoundingClientRect(),this.scrollBarLimit={x:this.scrollbarWidth-this.scrollbarThumbBCR.width,y:this.scrollbarHeight-this.scrollbarThumbBCR.height}}},{key:"reinitScrollBar",value:function(){if(this.hasScrollbar=!1,"horizontal"==this.direction){if(this.instance.limit.x+this.windowWidth<=this.windowWidth)return}else if(this.instance.limit.y+this.windowHeight<=this.windowHeight)return;this.hasScrollbar=!0,this.scrollbarBCR=this.scrollbar.getBoundingClientRect(),this.scrollbarHeight=this.scrollbarBCR.height,this.scrollbarWidth=this.scrollbarBCR.width,"horizontal"===this.direction?this.scrollbarThumb.style.width="".concat(this.scrollbarWidth*this.scrollbarWidth/(this.instance.limit.x+this.scrollbarWidth),"px"):this.scrollbarThumb.style.height="".concat(this.scrollbarHeight*this.scrollbarHeight/(this.instance.limit.y+this.scrollbarHeight),"px"),this.scrollbarThumbBCR=this.scrollbarThumb.getBoundingClientRect(),this.scrollBarLimit={x:this.scrollbarWidth-this.scrollbarThumbBCR.width,y:this.scrollbarHeight-this.scrollbarThumbBCR.height}}},{key:"destroyScrollBar",value:function(){this.scrollbarThumb.removeEventListener("mousedown",this.getScrollBar),window.removeEventListener("mouseup",this.releaseScrollBar),window.removeEventListener("mousemove",this.moveScrollBar),this.scrollbar.remove()}},{key:"getScrollBar",value:function(t){this.isDraggingScrollbar=!0,this.checkScroll(),this.html.classList.remove(this.scrollingClass),this.html.classList.add(this.draggingClass)}},{key:"releaseScrollBar",value:function(t){this.isDraggingScrollbar=!1,this.isScrolling&&this.html.classList.add(this.scrollingClass),this.html.classList.remove(this.draggingClass)}},{key:"moveScrollBar",value:function(t){var e=this;this.isDraggingScrollbar&&requestAnimationFrame((function(){var i=100*(t.clientX-e.scrollbarBCR.left)/e.scrollbarWidth*e.instance.limit.x/100,s=100*(t.clientY-e.scrollbarBCR.top)/e.scrollbarHeight*e.instance.limit.y/100;s>0&&s<e.instance.limit.y&&(e.instance.delta.y=s),i>0&&i<e.instance.limit.x&&(e.instance.delta.x=i)}))}},{key:"addElements",value:function(){var t=this;this.els={},this.parallaxElements={},this.el.querySelectorAll("[data-".concat(this.name,"]")).forEach((function(e,i){var s,r,n,a=G(e),o=Object.entries(t.sections).map((function(t){var e=g(t,2);e[0];return e[1]})).find((function(t){return a.includes(t.el)})),h=e.dataset[t.name+"Class"]||t.class,l="string"==typeof e.dataset[t.name+"Id"]?e.dataset[t.name+"Id"]:"el"+i,c=e.dataset[t.name+"Repeat"],d=e.dataset[t.name+"Call"],u=e.dataset[t.name+"Position"],p=e.dataset[t.name+"Delay"],m=e.dataset[t.name+"Direction"],f="string"==typeof e.dataset[t.name+"Sticky"],_=!!e.dataset[t.name+"Speed"]&&parseFloat(e.dataset[t.name+"Speed"])/10,y="string"==typeof e.dataset[t.name+"Offset"]?e.dataset[t.name+"Offset"].split(","):t.offset,v=e.dataset[t.name+"Target"],x=(n=void 0!==v?document.querySelector("".concat(v)):e).getBoundingClientRect();null===o||o.inView?(s=x.top+t.instance.scroll.y-Y(n).y,r=x.left+t.instance.scroll.x-Y(n).x):(s=x.top-Y(o.el).y-Y(n).y,r=x.left-Y(o.el).x-Y(n).x);var b=s+n.offsetHeight,w=r+n.offsetWidth,S={x:(w-r)/2+r,y:(b-s)/2+s};if(f){var T=e.getBoundingClientRect(),R=T.top,E=T.left,P={x:E-r,y:R-s};s+=window.innerHeight,r+=window.innerWidth,b=R+n.offsetHeight-e.offsetHeight-P[t.directionAxis],S={x:((w=E+n.offsetWidth-e.offsetWidth-P[t.directionAxis])-r)/2+r,y:(b-s)/2+s}}c="false"!=c&&(null!=c||t.repeat);var k=[0,0];if(y)if("horizontal"===t.direction){for(var C=0;C<y.length;C++)"string"==typeof y[C]?y[C].includes("%")?k[C]=parseInt(y[C].replace("%","")*t.windowWidth/100):k[C]=parseInt(y[C]):k[C]=y[C];r+=k[0],w-=k[1]}else{for(C=0;C<y.length;C++)"string"==typeof y[C]?y[C].includes("%")?k[C]=parseInt(y[C].replace("%","")*t.windowHeight/100):k[C]=parseInt(y[C]):k[C]=y[C];s+=k[0],b-=k[1]}var A={el:e,id:l,class:h,section:o,top:s,middle:S,bottom:b,left:r,right:w,offset:y,progress:0,repeat:c,inView:!1,call:d,speed:_,delay:p,position:u,target:n,direction:m,sticky:f};t.els[l]=A,e.classList.contains(h)&&t.setInView(t.els[l],l),(!1!==_||f)&&(t.parallaxElements[l]=A)}))}},{key:"addSections",value:function(){var t=this;this.sections={};var e=this.el.querySelectorAll("[data-".concat(this.name,"-section]"));0===e.length&&(e=[this.el]),e.forEach((function(e,i){var s="string"==typeof e.dataset[t.name+"Id"]?e.dataset[t.name+"Id"]:"section"+i,r=e.getBoundingClientRect(),n={x:r.left-1.5*window.innerWidth-Y(e).x,y:r.top-1.5*window.innerHeight-Y(e).y},a={x:n.x+r.width+2*window.innerWidth,y:n.y+r.height+2*window.innerHeight},o="string"==typeof e.dataset[t.name+"Persistent"];e.setAttribute("data-scroll-section-id",s);var h={el:e,offset:n,limit:a,inView:!1,persistent:o,id:s};t.sections[s]=h}))}},{key:"transform",value:function(t,e,i,s){var r;if(s){var n=Y(t),a=X(n.x,e,s),o=X(n.y,i,s);r="matrix3d(1,0,0.00,0,0.00,1,0.00,0,0,0,1,0,".concat(a,",").concat(o,",0,1)")}else r="matrix3d(1,0,0.00,0,0.00,1,0.00,0,0,0,1,0,".concat(e,",").concat(i,",0,1)");t.style.webkitTransform=r,t.style.msTransform=r,t.style.transform=r}},{key:"transformElements",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=this.instance.scroll.x+this.windowWidth,r=this.instance.scroll.y+this.windowHeight,n={x:this.instance.scroll.x+this.windowMiddle.x,y:this.instance.scroll.y+this.windowMiddle.y};Object.entries(this.parallaxElements).forEach((function(a){var o=g(a,2),h=(o[0],o[1]),l=!1;if(t&&(l=0),h.inView||i)switch(h.position){case"top":case"left":l=e.instance.scroll[e.directionAxis]*-h.speed;break;case"elementTop":l=(r-h.top)*-h.speed;break;case"bottom":l=(e.instance.limit[e.directionAxis]-r+e.windowHeight)*h.speed;break;case"elementLeft":l=(s-h.left)*-h.speed;break;case"right":l=(e.instance.limit[e.directionAxis]-s+e.windowHeight)*h.speed;break;default:l=(n[e.directionAxis]-h.middle[e.directionAxis])*-h.speed}h.sticky&&(l=h.inView?"horizontal"===e.direction?e.instance.scroll.x-h.left+window.innerWidth:e.instance.scroll.y-h.top+window.innerHeight:"horizontal"===e.direction?e.instance.scroll.x<h.left-window.innerWidth&&e.instance.scroll.x<h.left-window.innerWidth/2?0:e.instance.scroll.x>h.right&&e.instance.scroll.x>h.right+100&&h.right-h.left+window.innerWidth:e.instance.scroll.y<h.top-window.innerHeight&&e.instance.scroll.y<h.top-window.innerHeight/2?0:e.instance.scroll.y>h.bottom&&e.instance.scroll.y>h.bottom+100&&h.bottom-h.top+window.innerHeight),!1!==l&&("horizontal"===h.direction||"horizontal"===e.direction&&"vertical"!==h.direction?e.transform(h.el,l,0,!t&&h.delay):e.transform(h.el,0,l,!t&&h.delay))}))}},{key:"scrollTo",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=parseInt(i.offset)||0,r=isNaN(parseInt(i.duration))?1e3:parseInt(i.duration),n=i.easing||[.25,0,.35,1],a=!!i.disableLerp,o=!!i.callback&&i.callback;if(n=it.apply(void 0,f(n)),"string"==typeof t){if("top"===t)t=0;else if("bottom"===t)t=this.instance.limit.y;else if("left"===t)t=0;else if("right"===t)t=this.instance.limit.x;else if(!(t=document.querySelector(t)))return}else if("number"==typeof t)t=parseInt(t);else if(!t||!t.tagName)return;if("number"!=typeof t){if(!G(t).includes(this.el))return;var h=t.getBoundingClientRect(),l=h.top,c=h.left,d=G(t).find((function(t){return Object.entries(e.sections).map((function(t){var e=g(t,2);e[0];return e[1]})).find((function(e){return e.el==t}))})),u=0;u=d?Y(d)[this.directionAxis]:-this.instance.scroll[this.directionAxis],s="horizontal"===this.direction?c+s-u:l+s-u}else s=t+s;var p=parseFloat(this.instance.delta[this.directionAxis]),m=Math.max(0,Math.min(s,this.instance.limit[this.directionAxis]))-p,_=function(t){a?"horizontal"===e.direction?e.setScroll(p+m*t,e.instance.delta.y):e.setScroll(e.instance.delta.x,p+m*t):e.instance.delta[e.directionAxis]=p+m*t};this.animatingScroll=!0,this.stopScrolling(),this.startScrolling();var y=Date.now();!function t(){var i=(Date.now()-y)/r;i>1?(_(1),e.animatingScroll=!1,0==r&&e.update(),o&&o()):(e.scrollToRaf=requestAnimationFrame(t),_(n(i)))}()}},{key:"update",value:function(){this.setScrollLimit(),this.addSections(),this.addElements(),this.detectElements(),this.updateScroll(),this.transformElements(!0),this.reinitScrollBar(),this.checkScroll(!0)}},{key:"startScroll",value:function(){this.stop=!1}},{key:"stopScroll",value:function(){this.stop=!0}},{key:"setScroll",value:function(t,e){this.instance=h(h({},this.instance),{},{scroll:{x:t,y:e},delta:{x:t,y:e},speed:0})}},{key:"destroy",value:function(){m(c(i.prototype),"destroy",this).call(this),this.stopScrolling(),this.html.classList.remove(this.smoothClass),this.vs.destroy(),this.destroyScrollBar(),window.removeEventListener("keydown",this.checkKey,!1)}}]),i}(x);const ut=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this,t),this.options=e,Object.assign(this,v,e),this.smartphone=v.smartphone,e.smartphone&&Object.assign(this.smartphone,e.smartphone),this.tablet=v.tablet,e.tablet&&Object.assign(this.tablet,e.tablet),!this.smooth&&this.direction,!this.tablet.smooth&&this.tablet.direction,!this.smartphone.smooth&&this.smartphone.direction,this.init()}return n(t,[{key:"init",value:function(){if(this.options.isMobile=/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1||window.innerWidth<this.tablet.breakpoint,this.options.isTablet=this.options.isMobile&&window.innerWidth>=this.tablet.breakpoint,this.smooth&&!this.options.isMobile||this.tablet.smooth&&this.options.isTablet||this.smartphone.smooth&&this.options.isMobile&&!this.options.isTablet?this.scroll=new dt(this.options):this.scroll=new T(this.options),this.scroll.init(),window.location.hash){var t=window.location.hash.slice(1,window.location.hash.length),e=document.getElementById(t);e&&this.scroll.scrollTo(e)}}},{key:"update",value:function(){this.scroll.update()}},{key:"start",value:function(){this.scroll.startScroll()}},{key:"stop",value:function(){this.scroll.stopScroll()}},{key:"scrollTo",value:function(t,e){this.scroll.scrollTo(t,e)}},{key:"setScroll",value:function(t,e){this.scroll.setScroll(t,e)}},{key:"on",value:function(t,e){this.scroll.setEvents(t,e)}},{key:"off",value:function(t,e){this.scroll.unsetEvents(t,e)}},{key:"destroy",value:function(){this.scroll.destroy()}}]),t}()},846:function(t){t.exports=function(){"use strict";var t=document,e=t.createTextNode.bind(t);function i(t,e,i){t.style.setProperty(e,i)}function s(t,e){return t.appendChild(e)}function r(e,i,r,n){var a=t.createElement("span");return i&&(a.className=i),r&&(!n&&a.setAttribute("data-"+i,r),a.textContent=r),e&&s(e,a)||a}function n(t,e){return t.getAttribute("data-"+e)}function a(e,i){return e&&0!=e.length?e.nodeName?[e]:[].slice.call(e[0].nodeName?e:(i||t).querySelectorAll(e)):[]}function o(t){for(var e=[];t--;)e[t]=[];return e}function h(t,e){t&&t.some(e)}function l(t){return function(e){return t[e]}}function c(t,e,s){var r="--"+e,n=r+"-index";h(s,(function(t,e){Array.isArray(t)?h(t,(function(t){i(t,n,e)})):i(t,n,e)})),i(t,r+"-total",s.length)}var d={};function u(t,e,i){var s=i.indexOf(t);if(-1==s)i.unshift(t),h(d[t].depends,(function(e){u(e,t,i)}));else{var r=i.indexOf(e);i.splice(s,1),i.splice(r,0,t)}return i}function p(t,e,i,s){return{by:t,depends:e,key:i,split:s}}function m(t){return u(t,0,[]).map(l(d))}function g(t){d[t.by]=t}function f(t,i,n,o,l){t.normalize();var c=[],d=document.createDocumentFragment();o&&c.push(t.previousSibling);var u=[];return a(t.childNodes).some((function(t){if(!t.tagName||t.hasChildNodes()){if(t.childNodes&&t.childNodes.length)return u.push(t),void c.push.apply(c,f(t,i,n,o,l));var s=t.wholeText||"",a=s.trim();a.length&&(" "===s[0]&&u.push(e(" ")),h(a.split(n),(function(t,e){e&&l&&u.push(r(d,"whitespace"," ",l));var s=r(d,i,t);c.push(s),u.push(s)}))," "===s[s.length-1]&&u.push(e(" ")))}else u.push(t)})),h(u,(function(t){s(d,t)})),t.innerHTML="",s(t,d),c}var _=0;function y(t,e){for(var i in e)t[i]=e[i];return t}var v="words",x=p(v,_,"word",(function(t){return f(t,"word",/\s+/,0,1)})),b="chars",w=p(b,[v],"char",(function(t,e,i){var s=[];return h(i[v],(function(t,i){s.push.apply(s,f(t,"char","",e.whitespace&&i))})),s}));function S(t){var e=(t=t||{}).key;return a(t.target||"[data-splitting]").map((function(i){var s=i["🍌"];if(!t.force&&s)return s;s=i["🍌"]={el:i};var r=m(t.by||n(i,"splitting")||b),a=y({},t);return h(r,(function(t){if(t.split){var r=t.by,n=(e?"-"+e:"")+t.key,o=t.split(i,a,s);n&&c(i,n,o),s[r]=o,i.classList.add(r)}})),i.classList.add("splitting"),s}))}function T(t){var e=(t=t||{}).target=r();return e.innerHTML=t.content,S(t),e.outerHTML}function R(t,e,i){var s=a(e.matching||t.children,t),r={};return h(s,(function(t){var e=Math.round(t[i]);(r[e]||(r[e]=[])).push(t)})),Object.keys(r).map(Number).sort(E).map(l(r))}function E(t,e){return t-e}S.html=T,S.add=g;var P=p("lines",[v],"line",(function(t,e,i){return R(t,{matching:i[v]},"offsetTop")})),k=p("items",_,"item",(function(t,e){return a(e.matching||t.children,t)})),C=p("rows",_,"row",(function(t,e){return R(t,e,"offsetTop")})),A=p("cols",_,"col",(function(t,e){return R(t,e,"offsetLeft")})),M=p("grid",["rows","cols"]),O="layout",L=p(O,_,_,(function(t,e){var o=e.rows=+(e.rows||n(t,"rows")||1),h=e.columns=+(e.columns||n(t,"columns")||1);if(e.image=e.image||n(t,"image")||t.currentSrc||t.src,e.image){var l=a("img",t)[0];e.image=l&&(l.currentSrc||l.src)}e.image&&i(t,"background-image","url("+e.image+")");for(var c=o*h,d=[],u=r(_,"cell-grid");c--;){var p=r(u,"cell");r(p,"cell-inner"),d.push(p)}return s(t,u),d})),D=p("cellRows",[O],"row",(function(t,e,i){var s=e.rows,r=o(s);return h(i[O],(function(t,e,i){r[Math.floor(e/(i.length/s))].push(t)})),r})),F=p("cellColumns",[O],"col",(function(t,e,i){var s=e.columns,r=o(s);return h(i[O],(function(t,e){r[e%s].push(t)})),r})),z=p("cells",["cellRows","cellColumns"],"cell",(function(t,e,i){return i[O]}));return g(x),g(w),g(P),g(k),g(C),g(A),g(M),g(L),g(D),g(F),g(z),S}()},96:(t,e,i)=>{"use strict";i.d(e,{s_:()=>p,JO:()=>it,Sg:()=>E});let s=0;function r(){if(!(s>100)){if(100===s);else{Array.prototype.slice.call(arguments)}s++}}function n(){Array.prototype.slice.call(arguments)}function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{let e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16).toUpperCase()}))}function o(t){return 0==(t&t-1)}class h{constructor(t){if(this.type="Scene",t&&"Renderer"===t.type){if(!t.gl)return void n(this.type+": Renderer WebGL context is undefined",t)}else n(this.type+": Renderer not passed as first argument",t);this.renderer=t,this.gl=t.gl,this.initStacks()}initStacks(){this.stacks={pingPong:[],renderTargets:[],opaque:[],transparent:[],renderPasses:[],scenePasses:[]}}resetPlaneStacks(){this.stacks.pingPong=[],this.stacks.renderTargets=[],this.stacks.opaque=[],this.stacks.transparent=[];for(let t=0;t<this.renderer.planes.length;t++)this.addPlane(this.renderer.planes[t])}resetShaderPassStacks(){this.stacks.scenePasses=[],this.stacks.renderPasses=[];for(let t=0;t<this.renderer.shaderPasses.length;t++)this.renderer.shaderPasses[t].index=t,this.renderer.shaderPasses[t]._isScenePass?this.stacks.scenePasses.push(this.renderer.shaderPasses[t]):this.stacks.renderPasses.push(this.renderer.shaderPasses[t]);0===this.stacks.scenePasses.length&&(this.renderer.state.scenePassIndex=null)}addToRenderTargetsStack(t){const e=this.renderer.planes.filter((e=>"PingPongPlane"!==e.type&&e.target&&e.uuid!==t.uuid));let i=-1;if(t.target._depth){for(let s=e.length-1;s>=0;s--)if(e[s].target.uuid===t.target.uuid){i=s+1;break}}else i=e.findIndex((e=>e.target.uuid===t.target.uuid));i=Math.max(0,i),e.splice(i,0,t),t.target._depth?(e.sort(((t,e)=>t.index-e.index)),e.sort(((t,e)=>e.renderOrder-t.renderOrder))):(e.sort(((t,e)=>e.index-t.index)),e.sort(((t,e)=>t.renderOrder-e.renderOrder))),e.sort(((t,e)=>t.target.index-e.target.index)),this.stacks.renderTargets=e}addToRegularPlaneStack(t){const e=this.renderer.planes.filter((e=>"PingPongPlane"!==e.type&&!e.target&&e._transparent===t._transparent&&e.uuid!==t.uuid));let i=-1;for(let s=e.length-1;s>=0;s--)if(e[s]._geometry.definition.id===t._geometry.definition.id){i=s+1;break}return i=Math.max(0,i),e.splice(i,0,t),e.sort(((t,e)=>t.index-e.index)),e}addPlane(t){if("PingPongPlane"===t.type)this.stacks.pingPong.push(t);else if(t.target)this.addToRenderTargetsStack(t);else if(t._transparent){const e=this.addToRegularPlaneStack(t);e.sort(((t,e)=>e.relativeTranslation.z-t.relativeTranslation.z)),e.sort(((t,e)=>e.renderOrder-t.renderOrder)),this.stacks.transparent=e}else{const e=this.addToRegularPlaneStack(t);e.sort(((t,e)=>e.renderOrder-t.renderOrder)),this.stacks.opaque=e}}removePlane(t){"PingPongPlane"===t.type?this.stacks.pingPong=this.stacks.pingPong.filter((e=>e.uuid!==t.uuid)):t.target?this.stacks.renderTargets=this.stacks.renderTargets.filter((e=>e.uuid!==t.uuid)):t._transparent?this.stacks.transparent=this.stacks.transparent.filter((e=>e.uuid!==t.uuid)):this.stacks.opaque=this.stacks.opaque.filter((e=>e.uuid!==t.uuid))}setPlaneRenderOrder(t){if("ShaderPass"===t.type)this.sortShaderPassStack(t._isScenePass?this.stacks.scenePasses:this.stacks.renderPasses);else if("PingPongPlane"===t.type)return;if(t.target)t.target._depth?(this.stacks.renderTargets.sort(((t,e)=>t.index-e.index)),this.stacks.renderTargets.sort(((t,e)=>e.renderOrder-t.renderOrder))):(this.stacks.renderTargets.sort(((t,e)=>e.index-t.index)),this.stacks.renderTargets.sort(((t,e)=>t.renderOrder-e.renderOrder))),this.stacks.renderTargets.sort(((t,e)=>t.target.index-e.target.index));else{const e=t._transparent?this.stacks.transparent:this.stacks.opaque,i=this.stacks.scenePasses.find(((t,e)=>t._isScenePass&&!t._depth&&0===e));!this.renderer.depth||i?(e.sort(((t,e)=>e.index-t.index)),t._transparent&&e.sort(((t,e)=>t.relativeTranslation.z-e.relativeTranslation.z)),e.sort(((t,e)=>t.renderOrder-e.renderOrder))):(e.sort(((t,e)=>t.index-e.index)),t._transparent&&e.sort(((t,e)=>e.relativeTranslation.z-t.relativeTranslation.z)),e.sort(((t,e)=>e.renderOrder-t.renderOrder)))}}addShaderPass(t){t._isScenePass?(this.stacks.scenePasses.push(t),this.sortShaderPassStack(this.stacks.scenePasses)):(this.stacks.renderPasses.push(t),this.sortShaderPassStack(this.stacks.renderPasses))}removeShaderPass(t){this.resetShaderPassStacks()}sortShaderPassStack(t){t.sort(((t,e)=>t.index-e.index)),t.sort(((t,e)=>t.renderOrder-e.renderOrder))}enableShaderPass(){this.stacks.scenePasses.length&&0===this.stacks.renderPasses.length&&this.renderer.planes.length&&(this.renderer.state.scenePassIndex=0,this.renderer.bindFrameBuffer(this.stacks.scenePasses[0].target))}drawRenderPasses(){this.stacks.scenePasses.length&&this.stacks.renderPasses.length&&this.renderer.planes.length&&(this.renderer.state.scenePassIndex=0,this.renderer.bindFrameBuffer(this.stacks.scenePasses[0].target));for(let t=0;t<this.stacks.renderPasses.length;t++)this.stacks.renderPasses[t]._startDrawing(),this.renderer.clearDepth()}drawScenePasses(){for(let t=0;t<this.stacks.scenePasses.length;t++)this.stacks.scenePasses[t]._startDrawing()}drawPingPongStack(){for(let t=0;t<this.stacks.pingPong.length;t++){const e=this.stacks.pingPong[t];e&&e._startDrawing()}}drawStack(t){for(let e=0;e<this.stacks[t].length;e++){const i=this.stacks[t][e];i&&i._startDrawing()}}draw(){this.drawPingPongStack(),this.enableShaderPass(),this.drawStack("renderTargets"),this.drawRenderPasses(),this.renderer.setBlending(!1),this.drawStack("opaque"),this.stacks.transparent.length&&(this.renderer.setBlending(!0),this.drawStack("transparent")),this.drawScenePasses()}}class l{constructor(){this.geometries=[],this.clear()}clear(){this.textures=[],this.programs=[]}getGeometryFromID(t){return this.geometries.find((e=>e.id===t))}addGeometry(t,e,i){this.geometries.push({id:t,vertices:e,uvs:i})}isSameShader(t,e){return 0===t.localeCompare(e)}getProgramFromShaders(t,e){return this.programs.find((i=>this.isSameShader(i.vsCode,t)&&this.isSameShader(i.fsCode,e)))}addProgram(t){this.programs.push(t)}getTextureFromSource(t){const e="string"==typeof t?t:t.src;return this.textures.find((t=>t.source&&t.source.src===e))}addTexture(t){this.getTextureFromSource(t.source)||this.textures.push(t)}removeTexture(t){this.textures=this.textures.filter((e=>e.uuid!==t.uuid))}}class c{constructor(){this.clear()}clear(){this.queue=[]}add(t,e=!1){const i={callback:t,keep:e,timeout:null};return i.timeout=setTimeout((()=>{this.queue.push(i)}),0),i}execute(){this.queue.map((t=>{t.callback&&t.callback(),clearTimeout(this.queue.timeout)})),this.queue=this.queue.filter((t=>t.keep))}}class d{constructor({alpha:t,antialias:e,premultipliedAlpha:i,depth:s,failIfMajorPerformanceCaveat:n,preserveDrawingBuffer:a,stencil:o,container:h,pixelRatio:l,renderingScale:c,production:d,onError:u,onSuccess:p,onContextLost:m,onContextRestored:g,onDisposed:f,onSceneChange:_}){this.type="Renderer",this.alpha=t,this.antialias=e,this.premultipliedAlpha=i,this.depth=s,this.failIfMajorPerformanceCaveat=n,this.preserveDrawingBuffer=a,this.stencil=o,this.container=h,this.pixelRatio=l,this._renderingScale=c,this.production=d,this.onError=u,this.onSuccess=p,this.onContextLost=m,this.onContextRestored=g,this.onDisposed=f,this.onSceneChange=_,this.initState(),this.canvas=document.createElement("canvas");const y={alpha:this.alpha,premultipliedAlpha:this.premultipliedAlpha,antialias:this.antialias,depth:this.depth,failIfMajorPerformanceCaveat:this.failIfMajorPerformanceCaveat,preserveDrawingBuffer:this.preserveDrawingBuffer,stencil:this.stencil};if(this.gl=this.canvas.getContext("webgl2",y),this._isWebGL2=!!this.gl,this.gl||(this.gl=this.canvas.getContext("webgl",y)||this.canvas.getContext("experimental-webgl",y)),!this.gl)return this.production||r(this.type+": WebGL context could not be created"),this.state.isActive=!1,void(this.onError&&this.onError());this.onSuccess&&this.onSuccess(),this.initRenderer()}initState(){this.state={isActive:!0,isContextLost:!0,drawingEnabled:!0,forceRender:!1,currentProgramID:null,currentGeometryID:null,forceBufferUpdate:!1,depthTest:null,blending:null,cullFace:null,frameBufferID:null,scenePassIndex:null,activeTexture:null,unpackAlignment:null,flipY:null,premultiplyAlpha:null}}initCallbackQueueManager(){this.nextRender=new c}initRenderer(){this.planes=[],this.renderTargets=[],this.shaderPasses=[],this.state.isContextLost=!1,this.state.maxTextureSize=this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),this.initCallbackQueueManager(),this.setBlendFunc(),this.setDepthFunc(),this.setDepthTest(!0),this.cache=new l,this.scene=new h(this),this.getExtensions(),this._contextLostHandler=this.contextLost.bind(this),this.canvas.addEventListener("webglcontextlost",this._contextLostHandler,!1),this._contextRestoredHandler=this.contextRestored.bind(this),this.canvas.addEventListener("webglcontextrestored",this._contextRestoredHandler,!1)}getExtensions(){this.extensions=[],this._isWebGL2?(this.extensions.EXT_color_buffer_float=this.gl.getExtension("EXT_color_buffer_float"),this.extensions.OES_texture_float_linear=this.gl.getExtension("OES_texture_float_linear"),this.extensions.EXT_texture_filter_anisotropic=this.gl.getExtension("EXT_texture_filter_anisotropic"),this.extensions.WEBGL_lose_context=this.gl.getExtension("WEBGL_lose_context")):(this.extensions.OES_vertex_array_object=this.gl.getExtension("OES_vertex_array_object"),this.extensions.OES_texture_float=this.gl.getExtension("OES_texture_float"),this.extensions.OES_texture_float_linear=this.gl.getExtension("OES_texture_float_linear"),this.extensions.OES_texture_half_float=this.gl.getExtension("OES_texture_half_float"),this.extensions.OES_texture_half_float_linear=this.gl.getExtension("OES_texture_half_float_linear"),this.extensions.EXT_texture_filter_anisotropic=this.gl.getExtension("EXT_texture_filter_anisotropic"),this.extensions.OES_element_index_uint=this.gl.getExtension("OES_element_index_uint"),this.extensions.OES_standard_derivatives=this.gl.getExtension("OES_standard_derivatives"),this.extensions.EXT_sRGB=this.gl.getExtension("EXT_sRGB"),this.extensions.WEBGL_depth_texture=this.gl.getExtension("WEBGL_depth_texture"),this.extensions.WEBGL_draw_buffers=this.gl.getExtension("WEBGL_draw_buffers"),this.extensions.WEBGL_lose_context=this.gl.getExtension("WEBGL_lose_context"))}contextLost(t){this.state.isContextLost=!0,this.state.isActive&&(t.preventDefault(),this.nextRender.add((()=>this.onContextLost&&this.onContextLost())))}restoreContext(){this.state.isActive&&(this.initState(),this.gl&&this.extensions.WEBGL_lose_context?this.extensions.WEBGL_lose_context.restoreContext():(this.gl||this.production?this.extensions.WEBGL_lose_context||this.production||r(this.type+": Could not restore the context because the restore context extension is not defined"):r(this.type+": Could not restore the context because the context is not defined"),this.onError&&this.onError()))}isContextexFullyRestored(){let t=!0;for(let e=0;e<this.renderTargets.length;e++){this.renderTargets[e].textures[0]._canDraw||(t=!1);break}if(t)for(let e=0;e<this.planes.length;e++){if(!this.planes[e]._canDraw){t=!1;break}for(let i=0;i<this.planes[e].textures.length;i++)if(!this.planes[e].textures[i]._canDraw){t=!1;break}}if(t)for(let e=0;e<this.shaderPasses.length;e++){if(!this.shaderPasses[e]._canDraw){t=!1;break}for(let i=0;i<this.shaderPasses[e].textures.length;i++)if(!this.shaderPasses[e].textures[i]._canDraw){t=!1;break}}return t}contextRestored(){this.getExtensions(),this.setBlendFunc(),this.setDepthFunc(),this.setDepthTest(!0),this.cache.clear(),this.scene.initStacks();for(let t=0;t<this.renderTargets.length;t++)this.renderTargets[t]._restoreContext();for(let t=0;t<this.planes.length;t++)this.planes[t]._restoreContext();for(let t=0;t<this.shaderPasses.length;t++)this.shaderPasses[t]._restoreContext();const t=this.nextRender.add((()=>{this.isContextexFullyRestored()&&(t.keep=!1,this.state.isContextLost=!1,this.onContextRestored&&this.onContextRestored(),this.onSceneChange(),this.needRender())}),!0)}setPixelRatio(t){this.pixelRatio=t}setSize(){if(!this.gl)return;const t=this.container.getBoundingClientRect();this._boundingRect={width:t.width*this.pixelRatio,height:t.height*this.pixelRatio,top:t.top*this.pixelRatio,left:t.left*this.pixelRatio};const e=!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/),i=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;if(e&&i){function s(t){let e=0;for(;t&&!isNaN(t.offsetTop);)e+=t.offsetTop-t.scrollTop,t=t.offsetParent;return e}this._boundingRect.top=s(this.container)*this.pixelRatio}this.canvas.style.width=Math.floor(this._boundingRect.width/this.pixelRatio)+"px",this.canvas.style.height=Math.floor(this._boundingRect.height/this.pixelRatio)+"px",this.canvas.width=Math.floor(this._boundingRect.width*this._renderingScale),this.canvas.height=Math.floor(this._boundingRect.height*this._renderingScale),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}resize(){for(let t=0;t<this.planes.length;t++)this.planes[t]._canDraw&&this.planes[t].resize();for(let t=0;t<this.shaderPasses.length;t++)this.shaderPasses[t]._canDraw&&this.shaderPasses[t].resize();for(let t=0;t<this.renderTargets.length;t++)this.renderTargets[t].resize();this.needRender()}clear(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}clearDepth(){this.gl.clear(this.gl.DEPTH_BUFFER_BIT)}clearColor(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}bindFrameBuffer(t,e){let i=null;t?(i=t.index,i!==this.state.frameBufferID&&(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t._frameBuffer),this.gl.viewport(0,0,t._size.width,t._size.height),t._shouldClear&&!e&&this.clear())):null!==this.state.frameBufferID&&(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)),this.state.frameBufferID=i}setDepthTest(t){t&&!this.state.depthTest?(this.state.depthTest=t,this.gl.enable(this.gl.DEPTH_TEST)):!t&&this.state.depthTest&&(this.state.depthTest=t,this.gl.disable(this.gl.DEPTH_TEST))}setDepthFunc(){this.gl.depthFunc(this.gl.LEQUAL)}setBlending(t=!1){t&&!this.state.blending?(this.state.blending=t,this.gl.enable(this.gl.BLEND)):!t&&this.state.blending&&(this.state.blending=t,this.gl.disable(this.gl.BLEND))}setBlendFunc(){this.gl.enable(this.gl.BLEND),this.premultipliedAlpha?this.gl.blendFuncSeparate(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.gl.blendFuncSeparate(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)}setFaceCulling(t){if(this.state.cullFace!==t)if(this.state.cullFace=t,"none"===t)this.gl.disable(this.gl.CULL_FACE);else{const e="front"===t?this.gl.FRONT:this.gl.BACK;this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(e)}}useProgram(t){null!==this.state.currentProgramID&&this.state.currentProgramID===t.id||(this.gl.useProgram(t.program),this.state.currentProgramID=t.id)}removePlane(t){this.gl&&(this.planes=this.planes.filter((e=>e.uuid!==t.uuid)),this.scene.removePlane(t),t=null,this.gl&&this.clear(),this.onSceneChange())}removeRenderTarget(t){if(!this.gl)return;let e=this.planes.find((e=>"PingPongPlane"!==e.type&&e.target&&e.target.uuid===t.uuid));for(let e=0;e<this.planes.length;e++)this.planes[e].target&&this.planes[e].target.uuid===t.uuid&&(this.planes[e].target=null);this.renderTargets=this.renderTargets.filter((e=>e.uuid!==t.uuid));for(let t=0;t<this.renderTargets.length;t++)this.renderTargets[t].index=t;t=null,this.gl&&this.clear(),e&&this.scene.resetPlaneStacks(),this.onSceneChange()}removeShaderPass(t){this.gl&&(this.shaderPasses=this.shaderPasses.filter((e=>e.uuid!==t.uuid)),this.scene.removeShaderPass(t),t=null,this.gl&&this.clear(),this.onSceneChange())}enableDrawing(){this.state.drawingEnabled=!0}disableDrawing(){this.state.drawingEnabled=!1}needRender(){this.state.forceRender=!0}render(){this.gl&&(this.clear(),this.state.currentGeometryID=null,this.scene.draw())}deletePrograms(){for(let t=0;t<this.cache.programs.length;t++){const e=this.cache.programs[t];this.gl.deleteProgram(e.program)}}dispose(){if(!this.gl)return;for(this.state.isActive=!1;this.planes.length>0;)this.removePlane(this.planes[0]);for(;this.shaderPasses.length>0;)this.removeShaderPass(this.shaderPasses[0]);for(;this.renderTargets.length>0;)this.removeRenderTarget(this.renderTargets[0]);let t=this.nextRender.add((()=>{0===this.planes.length&&0===this.shaderPasses.length&&0===this.renderTargets.length&&(t.keep=!1,this.deletePrograms(),this.clear(),this.canvas.removeEventListener("webgllost",this._contextLostHandler,!1),this.canvas.removeEventListener("webglrestored",this._contextRestoredHandler,!1),this.gl&&this.extensions.WEBGL_lose_context&&this.extensions.WEBGL_lose_context.loseContext(),this.canvas.width=this.canvas.width,this.gl=null,this.container.removeChild(this.canvas),this.container=null,this.canvas=null,this.onDisposed&&this.onDisposed())}),!0)}}class u{constructor({xOffset:t=0,yOffset:e=0,lastXDelta:i=0,lastYDelta:s=0,shouldWatch:r=!0,onScroll:n=(()=>{})}={}){this.xOffset=t,this.yOffset=e,this.lastXDelta=i,this.lastYDelta=s,this.shouldWatch=r,this.onScroll=n,this.handler=this.scroll.bind(this,!0),this.shouldWatch&&window.addEventListener("scroll",this.handler,{passive:!0})}scroll(){this.updateScrollValues(window.pageXOffset,window.pageYOffset)}updateScrollValues(t,e){const i=this.xOffset;this.xOffset=t,this.lastXDelta=i-this.xOffset;const s=this.yOffset;this.yOffset=e,this.lastYDelta=s-this.yOffset,this.onScroll&&this.onScroll(this.lastXDelta,this.lastYDelta)}dispose(){this.shouldWatch&&window.removeEventListener("scroll",this.handler,{passive:!0})}}class p{constructor({container:t,alpha:e=!0,premultipliedAlpha:i=!1,antialias:s=!0,depth:n=!0,failIfMajorPerformanceCaveat:a=!0,preserveDrawingBuffer:o=!1,stencil:h=!1,autoResize:l=!0,autoRender:c=!0,watchScroll:d=!0,pixelRatio:u=window.devicePixelRatio||1,renderingScale:p=1,production:m=!1}={}){this.type="Curtains",this._autoResize=l,this._autoRender=c,this._watchScroll=d,this.pixelRatio=u,p=isNaN(p)?1:parseFloat(p),this._renderingScale=Math.max(.25,Math.min(1,p)),this.premultipliedAlpha=i,this.alpha=e,this.antialias=s,this.depth=n,this.failIfMajorPerformanceCaveat=a,this.preserveDrawingBuffer=o,this.stencil=h,this.production=m,this.errors=!1,t?this.setContainer(t):this.production||r(this.type+": no container provided in the initial parameters. Use setContainer() method to set one later and initialize the WebGL context")}setContainer(t){if(t)if("string"==typeof t)if(t=document.getElementById(t))this.container=t;else{let t=document.createElement("div");t.setAttribute("id","curtains-canvas"),document.body.appendChild(t),this.container=t,this.production||r('Curtains: no valid container HTML element or ID provided, created a div with "curtains-canvas" ID instead')}else t instanceof Element&&(this.container=t);else{let t=document.createElement("div");t.setAttribute("id","curtains-canvas"),document.body.appendChild(t),this.container=t,this.production||r('Curtains: no valid container HTML element or ID provided, created a div with "curtains-canvas" ID instead')}this._initCurtains()}_initCurtains(){this.planes=[],this.renderTargets=[],this.shaderPasses=[],this._initRenderer(),this.gl&&(this._initScroll(),this._setSize(),this._addListeners(),this.container.appendChild(this.canvas),this._animationFrameID=null,this._autoRender&&this._animate())}_initRenderer(){this.renderer=new d({alpha:this.alpha,antialias:this.antialias,premultipliedAlpha:this.premultipliedAlpha,depth:this.depth,failIfMajorPerformanceCaveat:this.failIfMajorPerformanceCaveat,preserveDrawingBuffer:this.preserveDrawingBuffer,stencil:this.stencil,container:this.container,pixelRatio:this.pixelRatio,renderingScale:this._renderingScale,production:this.production,onError:()=>this._onRendererError(),onSuccess:()=>this._onRendererSuccess(),onContextLost:()=>this._onRendererContextLost(),onContextRestored:()=>this._onRendererContextRestored(),onDisposed:()=>this._onRendererDisposed(),onSceneChange:()=>this._keepSync()}),this.gl=this.renderer.gl,this.canvas=this.renderer.canvas}restoreContext(){this.renderer.restoreContext()}_animate(){this.render(),this._animationFrameID=window.requestAnimationFrame(this._animate.bind(this))}enableDrawing(){this.renderer.enableDrawing()}disableDrawing(){this.renderer.disableDrawing()}needRender(){this.renderer.needRender()}nextRender(t,e=!1){return this.renderer.nextRender.add(t,e)}clear(){this.renderer&&this.renderer.clear()}clearDepth(){this.renderer&&this.renderer.clearDepth()}clearColor(){this.renderer&&this.renderer.clearColor()}isWebGL2(){return!!this.gl&&this.renderer._isWebGL2}render(){this.renderer.nextRender.execute(),(this.renderer.state.drawingEnabled||this.renderer.state.forceRender)&&(this.renderer.state.forceRender&&(this.renderer.state.forceRender=!1),this._onRenderCallback&&this._onRenderCallback(),this.renderer.render())}_addListeners(){this._resizeHandler=null,this._autoResize&&(this._resizeHandler=this.resize.bind(this,!0),window.addEventListener("resize",this._resizeHandler,!1))}setPixelRatio(t,e){this.pixelRatio=parseFloat(Math.max(t,1))||1,this.renderer.setPixelRatio(t),this.resize(e)}_setSize(){this.renderer.setSize(),this._scrollManager.shouldWatch&&(this._scrollManager.xOffset=window.pageXOffset,this._scrollManager.yOffset=window.pageYOffset)}getBoundingRect(){return this.renderer._boundingRect}resize(t){this.gl&&(this._setSize(),this.renderer.resize(),this.nextRender((()=>{this._onAfterResizeCallback&&t&&this._onAfterResizeCallback()})))}_initScroll(){this._scrollManager=new u({xOffset:window.pageXOffset,yOffset:window.pageYOffset,lastXDelta:0,lastYDelta:0,shouldWatch:this._watchScroll,onScroll:(t,e)=>this._updateScroll(t,e)})}_updateScroll(t,e){for(let i=0;i<this.planes.length;i++)this.planes[i].watchScroll&&this.planes[i].updateScrollPosition(t,e);this.renderer.needRender(),this._onScrollCallback&&this._onScrollCallback()}updateScrollValues(t,e){this._scrollManager.updateScrollValues(t,e)}getScrollDeltas(){return{x:this._scrollManager.lastXDelta,y:this._scrollManager.lastYDelta}}getScrollValues(){return{x:this._scrollManager.xOffset,y:this._scrollManager.yOffset}}_keepSync(){this.planes=this.renderer.planes,this.shaderPasses=this.renderer.shaderPasses,this.renderTargets=this.renderer.renderTargets}lerp(t,e,i){return function(t,e,i){return(1-i)*t+i*e}(t,e,i)}onAfterResize(t){return t&&(this._onAfterResizeCallback=t),this}onError(t){return t&&(this._onErrorCallback=t),this}_onRendererError(){setTimeout((()=>{this._onErrorCallback&&!this.errors&&this._onErrorCallback(),this.errors=!0}),0)}onSuccess(t){return t&&(this._onSuccessCallback=t),this}_onRendererSuccess(){setTimeout((()=>{this._onSuccessCallback&&this._onSuccessCallback()}),0)}onContextLost(t){return t&&(this._onContextLostCallback=t),this}_onRendererContextLost(){this._onContextLostCallback&&this._onContextLostCallback()}onContextRestored(t){return t&&(this._onContextRestoredCallback=t),this}_onRendererContextRestored(){this._onContextRestoredCallback&&this._onContextRestoredCallback()}onRender(t){return t&&(this._onRenderCallback=t),this}onScroll(t){return t&&(this._onScrollCallback=t),this}dispose(){this.renderer.dispose()}_onRendererDisposed(){this._animationFrameID&&window.cancelAnimationFrame(this._animationFrameID),this._resizeHandler&&window.removeEventListener("resize",this._resizeHandler,!1),this._scrollManager&&this._scrollManager.dispose()}}class m{constructor(t,e,i){if(this.type="Uniforms",t&&"Renderer"===t.type){if(!t.gl)return void n(this.type+": Renderer WebGL context is undefined",t)}else n(this.type+": Renderer not passed as first argument",t);if(this.renderer=t,this.gl=t.gl,this.program=e,this.uniforms={},i)for(const t in i){const e=i[t];this.uniforms[t]={name:e.name,type:e.type,value:e.value.clone&&"function"==typeof e.value.clone?e.value.clone():e.value,update:null}}}handleUniformSetting(t){switch(t.type){case"1i":t.update=this.setUniform1i.bind(this);break;case"1iv":t.update=this.setUniform1iv.bind(this);break;case"1f":t.update=this.setUniform1f.bind(this);break;case"1fv":t.update=this.setUniform1fv.bind(this);break;case"2i":t.update=this.setUniform2i.bind(this);break;case"2iv":t.update=this.setUniform2iv.bind(this);break;case"2f":t.update=this.setUniform2f.bind(this);break;case"2fv":t.update=this.setUniform2fv.bind(this);break;case"3i":t.update=this.setUniform3i.bind(this);break;case"3iv":t.update=this.setUniform3iv.bind(this);break;case"3f":t.update=this.setUniform3f.bind(this);break;case"3fv":t.update=this.setUniform3fv.bind(this);break;case"4i":t.update=this.setUniform4i.bind(this);break;case"4iv":t.update=this.setUniform4iv.bind(this);break;case"4f":t.update=this.setUniform4f.bind(this);break;case"4fv":t.update=this.setUniform4fv.bind(this);break;case"mat2":t.update=this.setUniformMatrix2fv.bind(this);break;case"mat3":t.update=this.setUniformMatrix3fv.bind(this);break;case"mat4":t.update=this.setUniformMatrix4fv.bind(this);break;default:this.renderer.production||r(this.type+": This uniform type is not handled : ",t.type)}}setInternalFormat(t){"Vec2"===t.value.type?(t._internalFormat="Vec2",t.lastValue=t.value.clone()):"Vec3"===t.value.type?(t._internalFormat="Vec3",t.lastValue=t.value.clone()):"Mat4"===t.value.type?(t._internalFormat="Mat4",t.lastValue=t.value.clone()):"Quat"===t.value.type?(t._internalFormat="Quat",t.lastValue=t.value.clone()):Array.isArray(t.value)?(t._internalFormat="array",t.lastValue=Array.from(t.value)):t.value.constructor===Float32Array?(t._internalFormat="mat",t.lastValue=t.value):(t._internalFormat="float",t.lastValue=t.value)}setUniforms(){if(this.uniforms)for(const t in this.uniforms){let e=this.uniforms[t];e.location=this.gl.getUniformLocation(this.program,e.name),e._internalFormat||this.setInternalFormat(e),e.type||("Vec2"===e._internalFormat?e.type="2f":"Vec3"===e._internalFormat?e.type="3f":"Mat4"===e._internalFormat?e.type="mat4":"array"===e._internalFormat?4===e.value.length?(e.type="4f",this.renderer.production||r(this.type+": No uniform type declared for "+e.name+", applied a 4f (array of 4 floats) uniform type")):3===e.value.length?(e.type="3f",this.renderer.production||r(this.type+": No uniform type declared for "+e.name+", applied a 3f (array of 3 floats) uniform type")):2===e.value.length&&(e.type="2f",this.renderer.production||r(this.type+": No uniform type declared for "+e.name+", applied a 2f (array of 2 floats) uniform type")):"mat"===e._internalFormat?16===e.value.length?(e.type="mat4",this.renderer.production||r(this.type+": No uniform type declared for "+e.name+", applied a mat4 (4x4 matrix array) uniform type")):9===e.value.length?(e.type="mat3",this.renderer.production||r(this.type+": No uniform type declared for "+e.name+", applied a mat3 (3x3 matrix array) uniform type")):4===e.value.length&&(e.type="mat2",this.renderer.production||r(this.type+": No uniform type declared for "+e.name+", applied a mat2 (2x2 matrix array) uniform type")):(e.type="1f",this.renderer.production||r(this.type+": No uniform type declared for "+e.name+", applied a 1f (float) uniform type"))),this.handleUniformSetting(e),e.update&&e.update(e)}}updateUniforms(){if(this.uniforms)for(const t in this.uniforms){const e=this.uniforms[t];let i=!1;"Vec2"===e._internalFormat||"Vec3"===e._internalFormat||"Quat"===e._internalFormat?e.value.equals(e.lastValue)||(i=!0,e.lastValue.copy(e.value)):e.value.length?JSON.stringify(e.value)!==JSON.stringify(e.lastValue)&&(i=!0,e.lastValue=Array.from(e.value)):e.value!==e.lastValue&&(i=!0,e.lastValue=e.value),i&&e.update&&e.update(e)}}setUniform1i(t){this.gl.uniform1i(t.location,t.value)}setUniform1iv(t){this.gl.uniform1iv(t.location,t.value)}setUniform1f(t){this.gl.uniform1f(t.location,t.value)}setUniform1fv(t){this.gl.uniform1fv(t.location,t.value)}setUniform2i(t){"Vec2"===t._internalFormat?this.gl.uniform2i(t.location,t.value.x,t.value.y):this.gl.uniform2i(t.location,t.value[0],t.value[1])}setUniform2iv(t){"Vec2"===t._internalFormat?this.gl.uniform2iv(t.location,[t.value.x,t.value.y]):this.gl.uniform2iv(t.location,t.value)}setUniform2f(t){"Vec2"===t._internalFormat?this.gl.uniform2f(t.location,t.value.x,t.value.y):this.gl.uniform2f(t.location,t.value[0],t.value[1])}setUniform2fv(t){"Vec2"===t._internalFormat?this.gl.uniform2fv(t.location,[t.value.x,t.value.y]):this.gl.uniform2fv(t.location,t.value)}setUniform3i(t){"Vec3"===t._internalFormat?this.gl.uniform3i(t.location,t.value.x,t.value.y,t.value.z):this.gl.uniform3i(t.location,t.value[0],t.value[1],t.value[2])}setUniform3iv(t){"Vec3"===t._internalFormat?this.gl.uniform3iv(t.location,[t.value.x,t.value.y,t.value.z]):this.gl.uniform3iv(t.location,t.value)}setUniform3f(t){"Vec3"===t._internalFormat?this.gl.uniform3f(t.location,t.value.x,t.value.y,t.value.z):this.gl.uniform3f(t.location,t.value[0],t.value[1],t.value[2])}setUniform3fv(t){"Vec3"===t._internalFormat?this.gl.uniform3fv(t.location,[t.value.x,t.value.y,t.value.z]):this.gl.uniform3fv(t.location,t.value)}setUniform4i(t){"Quat"===t._internalFormat?this.gl.uniform4i(t.location,t.value.elements[0],t.value.elements[1],t.value.elements[2],t.value[3]):this.gl.uniform4i(t.location,t.value[0],t.value[1],t.value[2],t.value[3])}setUniform4iv(t){"Quat"===t._internalFormat?this.gl.uniform4iv(t.location,[t.value.elements[0],t.value.elements[1],t.value.elements[2],t.value[3]]):this.gl.uniform4iv(t.location,t.value)}setUniform4f(t){"Quat"===t._internalFormat?this.gl.uniform4f(t.location,t.value.elements[0],t.value.elements[1],t.value.elements[2],t.value[3]):this.gl.uniform4f(t.location,t.value[0],t.value[1],t.value[2],t.value[3])}setUniform4fv(t){"Quat"===t._internalFormat?this.gl.uniform4fv(t.location,[t.value.elements[0],t.value.elements[1],t.value.elements[2],t.value[3]]):this.gl.uniform4fv(t.location,t.value)}setUniformMatrix2fv(t){this.gl.uniformMatrix2fv(t.location,!1,t.value)}setUniformMatrix3fv(t){this.gl.uniformMatrix3fv(t.location,!1,t.value)}setUniformMatrix4fv(t){"Mat4"===t._internalFormat?this.gl.uniformMatrix4fv(t.location,!1,t.value.elements):this.gl.uniformMatrix4fv(t.location,!1,t.value)}}const g="\nprecision mediump float;\n".replace(/\n/g,""),f="\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\n".replace(/\n/g,""),_="\nvarying vec3 vVertexPosition;\nvarying vec2 vTextureCoord;\n".replace(/\n/g,""),y=(g+f+_+"\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\n\nvoid main() {\n    vTextureCoord = aTextureCoord;\n    vVertexPosition = aVertexPosition;\n    \n    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}\n").replace(/\n/g,""),v=(g+_+"\nvoid main() {\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n").replace(/\n/g,""),x=(g+f+_+"\nvoid main() {\n    vTextureCoord = aTextureCoord;\n    vVertexPosition = aVertexPosition;\n    \n    gl_Position = vec4(aVertexPosition, 1.0);\n}\n").replace(/\n/g,""),b=(g+_+"\nuniform sampler2D uRenderTexture;\n\nvoid main() {\n    gl_FragColor = texture2D(uRenderTexture, vTextureCoord);\n}\n").replace(/\n/g,"");let w=0;class S{constructor(t,{parent:e,vertexShader:i,fragmentShader:s}={}){if(this.type="Program",t&&"Renderer"===t.type){if(!t.gl)return void n(this.type+": Renderer WebGL context is undefined",t)}else n(this.type+": Renderer not passed as first argument",t);this.renderer=t,this.gl=this.renderer.gl,this.parent=e,this.defaultVsCode="Plane"===this.parent.type?y:x,this.defaultFsCode="Plane"===this.parent.type?v:b,i?this.vsCode=i:(this.renderer.production||"Plane"!==this.parent.type||r(this.parent.type+": No vertex shader provided, will use a default one"),this.vsCode=this.defaultVsCode),s?this.fsCode=s:(this.renderer.production||r(this.parent.type+": No fragment shader provided, will use a default one"),this.fsCode=this.defaultFsCode),this.compiled=!0,this.setupProgram()}createShader(t,e){const i=this.gl.createShader(e);if(this.gl.shaderSource(i,t),this.gl.compileShader(i),!this.renderer.production&&!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)){const t=e===this.gl.VERTEX_SHADER?"vertex shader":"fragment shader";let s=this.gl.getShaderSource(i).split("\n");for(let t=0;t<s.length;t++)s[t]=t+1+": "+s[t];return s=s.join("\n"),r(this.type+": Errors occurred while compiling the",t,":\n",this.gl.getShaderInfoLog(i)),n(s),r(this.type+": Will use a default",t),this.createShader(e===this.gl.VERTEX_SHADER?this.defaultVsCode:this.defaultFsCode,e)}return i}useNewShaders(){this.vertexShader=this.createShader(this.vsCode,this.gl.VERTEX_SHADER),this.fragmentShader=this.createShader(this.fsCode,this.gl.FRAGMENT_SHADER),this.vertexShader&&this.fragmentShader||this.renderer.production||r(this.type+": Unable to find or compile the vertex or fragment shader")}setupProgram(){let t=this.renderer.cache.getProgramFromShaders(this.vsCode,this.fsCode);t?(this.vertexShader=t.vertexShader,this.fragmentShader=t.fragmentShader,this.activeUniforms=t.activeUniforms,this.activeAttributes=t.activeAttributes,this.createProgram()):(this.useNewShaders(),this.compiled&&(this.createProgram(),this.renderer.cache.addProgram(this)))}createProgram(){if(w++,this.id=w,this.program=this.gl.createProgram(),this.gl.attachShader(this.program,this.vertexShader),this.gl.attachShader(this.program,this.fragmentShader),this.gl.linkProgram(this.program),!this.renderer.production&&!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))return r(this.type+": Unable to initialize the shader program: "+this.gl.getProgramInfoLog(this.program)),r(this.type+": Will use default vertex and fragment shaders"),this.vertexShader=this.createShader(this.defaultVsCode,this.gl.VERTEX_SHADER),this.fragmentShader=this.createShader(this.defaultFsCode,this.gl.FRAGMENT_SHADER),void this.createProgram();if(this.gl.deleteShader(this.vertexShader),this.gl.deleteShader(this.fragmentShader),!this.activeUniforms||!this.activeAttributes){this.activeUniforms={textures:[],textureMatrices:[]};const t=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_UNIFORMS);for(let e=0;e<t;e++){const t=this.gl.getActiveUniform(this.program,e);t.type===this.gl.SAMPLER_2D&&this.activeUniforms.textures.push(t.name),t.type===this.gl.FLOAT_MAT4&&"uMVMatrix"!==t.name&&"uPMatrix"!==t.name&&this.activeUniforms.textureMatrices.push(t.name)}this.activeAttributes=[];const e=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_ATTRIBUTES);for(let t=0;t<e;t++){const e=this.gl.getActiveAttrib(this.program,t);this.activeAttributes.push(e.name)}}}createUniforms(t){this.uniformsManager=new m(this.renderer,this.program,t),this.setUniforms()}setUniforms(){this.renderer.useProgram(this),this.uniformsManager.setUniforms()}updateUniforms(){this.renderer.useProgram(this),this.uniformsManager.updateUniforms()}}class T{constructor(t,{program:e=null,width:i=1,height:s=1}={}){if(this.type="Geometry",t&&"Renderer"===t.type){if(!t.gl)return void n(this.type+": Renderer WebGL context is undefined",t)}else n(this.type+": Renderer not passed as first argument",t);this.renderer=t,this.gl=this.renderer.gl,this.definition={id:i*s+i,width:i,height:s},this.setDefaultAttributes(),this.setVerticesUVs()}restoreContext(t){this.program=null,this.setDefaultAttributes(),this.setVerticesUVs(),this.setProgram(t)}setDefaultAttributes(){this.attributes={vertexPosition:{name:"aVertexPosition",size:3,isActive:!1},textureCoord:{name:"aTextureCoord",size:3,isActive:!1}}}setVerticesUVs(){const t=this.renderer.cache.getGeometryFromID(this.definition.id);t?(this.attributes.vertexPosition.array=t.vertices,this.attributes.textureCoord.array=t.uvs):(this.computeVerticesUVs(),this.renderer.cache.addGeometry(this.definition.id,this.attributes.vertexPosition.array,this.attributes.textureCoord.array))}setProgram(t){this.program=t,this.initAttributes(),this.renderer._isWebGL2?(this._vao=this.gl.createVertexArray(),this.gl.bindVertexArray(this._vao)):this.renderer.extensions.OES_vertex_array_object&&(this._vao=this.renderer.extensions.OES_vertex_array_object.createVertexArrayOES(),this.renderer.extensions.OES_vertex_array_object.bindVertexArrayOES(this._vao)),this.initializeBuffers()}initAttributes(){for(const t in this.attributes){if(this.attributes[t].isActive=this.program.activeAttributes.includes(this.attributes[t].name),!this.attributes[t].isActive)return;this.attributes[t].location=this.gl.getAttribLocation(this.program.program,this.attributes[t].name),this.attributes[t].buffer=this.gl.createBuffer(),this.attributes[t].numberOfItems=this.definition.width*this.definition.height*this.attributes[t].size*2}}computeVerticesUVs(){this.attributes.vertexPosition.array=[],this.attributes.textureCoord.array=[];const t=this.attributes.vertexPosition.array,e=this.attributes.textureCoord.array;for(let i=0;i<this.definition.height;i++){const s=i/this.definition.height;for(let i=0;i<this.definition.width;i++){const r=i/this.definition.width;e.push(r),e.push(s),e.push(0),t.push(2*(r-.5)),t.push(2*(s-.5)),t.push(0),e.push(r+1/this.definition.width),e.push(s),e.push(0),t.push(2*(r+1/this.definition.width-.5)),t.push(2*(s-.5)),t.push(0),e.push(r),e.push(s+1/this.definition.height),e.push(0),t.push(2*(r-.5)),t.push(2*(s+1/this.definition.height-.5)),t.push(0),e.push(r),e.push(s+1/this.definition.height),e.push(0),t.push(2*(r-.5)),t.push(2*(s+1/this.definition.height-.5)),t.push(0),e.push(r+1/this.definition.width),e.push(s),e.push(0),t.push(2*(r+1/this.definition.width-.5)),t.push(2*(s-.5)),t.push(0),e.push(r+1/this.definition.width),e.push(s+1/this.definition.height),e.push(0),t.push(2*(r+1/this.definition.width-.5)),t.push(2*(s+1/this.definition.height-.5)),t.push(0)}}}initializeBuffers(){if(this.attributes){for(const t in this.attributes){if(!this.attributes[t].isActive)return;this.gl.enableVertexAttribArray(this.attributes[t].location),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attributes[t].buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.attributes[t].array),this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.attributes[t].location,this.attributes[t].size,this.gl.FLOAT,!1,0,0)}this.renderer.state.currentGeometryID=this.definition.id}}bindBuffers(){if(this._vao)this.renderer._isWebGL2?this.gl.bindVertexArray(this._vao):this.renderer.extensions.OES_vertex_array_object.bindVertexArrayOES(this._vao);else for(const t in this.attributes){if(!this.attributes[t].isActive)return;this.gl.enableVertexAttribArray(this.attributes[t].location),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attributes[t].buffer),this.gl.vertexAttribPointer(this.attributes[t].location,this.attributes[t].size,this.gl.FLOAT,!1,0,0)}this.renderer.state.currentGeometryID=this.definition.id}draw(){this.gl.drawArrays(this.gl.TRIANGLES,0,this.attributes.vertexPosition.numberOfItems)}dispose(){this._vao&&(this.renderer._isWebGL2?this.gl.deleteVertexArray(this._vao):this.renderer.extensions.OES_vertex_array_object.deleteVertexArrayOES(this._vao));for(const t in this.attributes){if(!this.attributes[t].isActive)return;this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attributes[t].buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,1,this.gl.STATIC_DRAW),this.gl.deleteBuffer(this.attributes[t].buffer)}this.attributes=null,this.renderer.state.currentGeometryID=null}}class R{constructor(t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])){this.type="Mat4",this.elements=t}setFromArray(t){for(let e=0;e<this.elements.length;e++)this.elements[e]=t[e];return this}copy(t){const e=t.elements;return this.elements[0]=e[0],this.elements[1]=e[1],this.elements[2]=e[2],this.elements[3]=e[3],this.elements[4]=e[4],this.elements[5]=e[5],this.elements[6]=e[6],this.elements[7]=e[7],this.elements[8]=e[8],this.elements[9]=e[9],this.elements[10]=e[10],this.elements[11]=e[11],this.elements[12]=e[12],this.elements[13]=e[13],this.elements[14]=e[14],this.elements[15]=e[15],this}clone(){return(new R).copy(this)}multiply(t){const e=this.elements,i=t.elements;let s=new R;return s.elements[0]=i[0]*e[0]+i[1]*e[4]+i[2]*e[8]+i[3]*e[12],s.elements[1]=i[0]*e[1]+i[1]*e[5]+i[2]*e[9]+i[3]*e[13],s.elements[2]=i[0]*e[2]+i[1]*e[6]+i[2]*e[10]+i[3]*e[14],s.elements[3]=i[0]*e[3]+i[1]*e[7]+i[2]*e[11]+i[3]*e[15],s.elements[4]=i[4]*e[0]+i[5]*e[4]+i[6]*e[8]+i[7]*e[12],s.elements[5]=i[4]*e[1]+i[5]*e[5]+i[6]*e[9]+i[7]*e[13],s.elements[6]=i[4]*e[2]+i[5]*e[6]+i[6]*e[10]+i[7]*e[14],s.elements[7]=i[4]*e[3]+i[5]*e[7]+i[6]*e[11]+i[7]*e[15],s.elements[8]=i[8]*e[0]+i[9]*e[4]+i[10]*e[8]+i[11]*e[12],s.elements[9]=i[8]*e[1]+i[9]*e[5]+i[10]*e[9]+i[11]*e[13],s.elements[10]=i[8]*e[2]+i[9]*e[6]+i[10]*e[10]+i[11]*e[14],s.elements[11]=i[8]*e[3]+i[9]*e[7]+i[10]*e[11]+i[11]*e[15],s.elements[12]=i[12]*e[0]+i[13]*e[4]+i[14]*e[8]+i[15]*e[12],s.elements[13]=i[12]*e[1]+i[13]*e[5]+i[14]*e[9]+i[15]*e[13],s.elements[14]=i[12]*e[2]+i[13]*e[6]+i[14]*e[10]+i[15]*e[14],s.elements[15]=i[12]*e[3]+i[13]*e[7]+i[14]*e[11]+i[15]*e[15],s}getInverse(){const t=this.elements,e=new R,i=e.elements;let s=t[0],r=t[1],n=t[2],a=t[3],o=t[4],h=t[5],l=t[6],c=t[7],d=t[8],u=t[9],p=t[10],m=t[11],g=t[12],f=t[13],_=t[14],y=t[15],v=s*h-r*o,x=s*l-n*o,b=s*c-a*o,w=r*l-n*h,S=r*c-a*h,T=n*c-a*l,E=d*f-u*g,P=d*_-p*g,k=d*y-m*g,C=u*_-p*f,A=u*y-m*f,M=p*y-m*_,O=v*M-x*A+b*C+w*k-S*P+T*E;return O?(O=1/O,i[0]=(h*M-l*A+c*C)*O,i[1]=(n*A-r*M-a*C)*O,i[2]=(f*T-_*S+y*w)*O,i[3]=(p*S-u*T-m*w)*O,i[4]=(l*k-o*M-c*P)*O,i[5]=(s*M-n*k+a*P)*O,i[6]=(_*b-g*T-y*x)*O,i[7]=(d*T-p*b+m*x)*O,i[8]=(o*A-h*k+c*E)*O,i[9]=(r*k-s*A-a*E)*O,i[10]=(g*S-f*b+y*v)*O,i[11]=(u*b-d*S-m*v)*O,i[12]=(h*P-o*C-l*E)*O,i[13]=(s*C-r*P+n*E)*O,i[14]=(f*x-g*w-_*v)*O,i[15]=(d*w-u*x+p*v)*O,e):null}scale(t){let e=this.elements;return e[0]*=t.x,e[1]*=t.x,e[2]*=t.x,e[3]*=t.x,e[4]*=t.y,e[5]*=t.y,e[6]*=t.y,e[7]*=t.y,e[8]*=t.z,e[9]*=t.z,e[10]*=t.z,e[11]*=t.z,this}compose(t,e,i){let s=this.elements;const r=e.elements[0],n=e.elements[1],a=e.elements[2],o=e.elements[3],h=r+r,l=n+n,c=a+a,d=r*h,u=r*l,p=r*c,m=n*l,g=n*c,f=a*c,_=o*h,y=o*l,v=o*c,x=i.x,b=i.y,w=i.z;return s[0]=(1-(m+f))*x,s[1]=(u+v)*x,s[2]=(p-y)*x,s[3]=0,s[4]=(u-v)*b,s[5]=(1-(d+f))*b,s[6]=(g+_)*b,s[7]=0,s[8]=(p+y)*w,s[9]=(g-_)*w,s[10]=(1-(d+m))*w,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}composeFromOrigin(t,e,i,s){let r=this.elements;const n=e.elements[0],a=e.elements[1],o=e.elements[2],h=e.elements[3],l=n+n,c=a+a,d=o+o,u=n*l,p=n*c,m=n*d,g=a*c,f=a*d,_=o*d,y=h*l,v=h*c,x=h*d,b=i.x,w=i.y,S=i.z,T=s.x,R=s.y,E=s.z,P=(1-(g+_))*b,k=(p+x)*b,C=(m-v)*b,A=(p-x)*w,M=(1-(u+_))*w,O=(f+y)*w,L=(m+v)*S,D=(f-y)*S,F=(1-(u+g))*S;return r[0]=P,r[1]=k,r[2]=C,r[3]=0,r[4]=A,r[5]=M,r[6]=O,r[7]=0,r[8]=L,r[9]=D,r[10]=F,r[11]=0,r[12]=t.x+T-(P*T+A*R+L*E),r[13]=t.y+R-(k*T+M*R+D*E),r[14]=t.z+E-(C*T+O*R+F*E),r[15]=1,this}}class E{constructor(t=0,e=t){this.type="Vec2",this._x=t,this._y=e}get x(){return this._x}get y(){return this._y}set x(t){const e=t!==this._x;this._x=t,e&&this._onChangeCallback&&this._onChangeCallback()}set y(t){const e=t!==this._y;this._y=t,e&&this._onChangeCallback&&this._onChangeCallback()}onChange(t){return t&&(this._onChangeCallback=t),this}set(t,e){return this._x=t,this._y=e,this}add(t){return this._x+=t.x,this._y+=t.y,this}addScalar(t){return this._x+=t,this._y+=t,this}sub(t){return this._x-=t.x,this._y-=t.y,this}subScalar(t){return this._x-=t,this._y-=t,this}multiply(t){return this._x*=t.x,this._y*=t.y,this}multiplyScalar(t){return this._x*=t,this._y*=t,this}copy(t){return this._x=t.x,this._y=t.y,this}clone(){return new E(this._x,this._y)}sanitizeNaNValuesWith(t){return this._x=isNaN(this._x)?t.x:parseFloat(this._x),this._y=isNaN(this._y)?t.y:parseFloat(this._y),this}max(t){return this._x=Math.max(this._x,t.x),this._y=Math.max(this._y,t.y),this}min(t){return this._x=Math.min(this._x,t.x),this._y=Math.min(this._y,t.y),this}equals(t){return this._x===t.x&&this._y===t.y}normalize(){let t=this._x*this._x+this._y*this._y;return t>0&&(t=1/Math.sqrt(t)),this._x*=t,this._y*=t,this}dot(t){return this._x*t.x+this._y*t.y}}class P{constructor(t=0,e=t,i=t){this.type="Vec3",this._x=t,this._y=e,this._z=i}get x(){return this._x}get y(){return this._y}get z(){return this._z}set x(t){const e=t!==this._x;this._x=t,e&&this._onChangeCallback&&this._onChangeCallback()}set y(t){const e=t!==this._y;this._y=t,e&&this._onChangeCallback&&this._onChangeCallback()}set z(t){const e=t!==this._z;this._z=t,e&&this._onChangeCallback&&this._onChangeCallback()}onChange(t){return t&&(this._onChangeCallback=t),this}set(t,e,i){return this._x=t,this._y=e,this._z=i,this}add(t){return this._x+=t.x,this._y+=t.y,this._z+=t.z,this}addScalar(t){return this._x+=t,this._y+=t,this._z+=t,this}sub(t){return this._x-=t.x,this._y-=t.y,this._z-=t.z,this}subScalar(t){return this._x-=t,this._y-=t,this._z-=t,this}multiply(t){return this._x*=t.x,this._y*=t.y,this._z*=t.z,this}multiplyScalar(t){return this._x*=t,this._y*=t,this._z*=t,this}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this}clone(){return new P(this._x,this._y,this._z)}sanitizeNaNValuesWith(t){return this._x=isNaN(this._x)?t.x:parseFloat(this._x),this._y=isNaN(this._y)?t.y:parseFloat(this._y),this._z=isNaN(this._z)?t.z:parseFloat(this._z),this}max(t){return this._x=Math.max(this._x,t.x),this._y=Math.max(this._y,t.y),this._z=Math.max(this._z,t.z),this}min(t){return this._x=Math.min(this._x,t.x),this._y=Math.min(this._y,t.y),this._z=Math.min(this._z,t.z),this}equals(t){return this._x===t.x&&this._y===t.y&&this._z===t.z}normalize(){let t=this._x*this._x+this._y*this._y+this._z*this._z;return t>0&&(t=1/Math.sqrt(t)),this._x*=t,this._y*=t,this._z*=t,this}dot(t){return this._x*t.x+this._y*t.y+this._z*t.z}applyMat4(t){const e=this._x,i=this._y,s=this._z,r=t.elements;let n=r[3]*e+r[7]*i+r[11]*s+r[15];return n=n||1,this._x=(r[0]*e+r[4]*i+r[8]*s+r[12])/n,this._y=(r[1]*e+r[5]*i+r[9]*s+r[13])/n,this._z=(r[2]*e+r[6]*i+r[10]*s+r[14])/n,this}applyQuat(t){const e=this._x,i=this._y,s=this._z,r=t.elements[0],n=t.elements[1],a=t.elements[2],o=t.elements[3],h=o*e+n*s-a*i,l=o*i+a*e-r*s,c=o*s+r*i-n*e,d=-r*e-n*i-a*s;return this._x=h*o+d*-r+l*-a-c*-n,this._y=l*o+d*-n+c*-r-h*-a,this._z=c*o+d*-a+h*-n-l*-r,this}project(t){return this.applyMat4(t.viewMatrix).applyMat4(t.projectionMatrix),this}unproject(t){return this.applyMat4(t.projectionMatrix.getInverse()).applyMat4(t.worldMatrix),this}}const k=new E,C=new P,A=new R;class M{constructor(t,{isFBOTexture:e=!1,fromTexture:i=!1,loader:s,sampler:r,floatingPoint:o="none",premultiplyAlpha:h=!1,anisotropy:l=1,generateMipmap:c=null,wrapS:d,wrapT:u,minFilter:p,magFilter:m}={}){if(this.type="Texture",(t=t&&t.renderer||t)&&"Renderer"===t.type){if(!t.gl)return void(t.production||n(this.type+": Unable to create a "+this.type+" because the Renderer WebGL context is not defined"))}else n(this.type+": Renderer not passed as first argument",t);if(this.renderer=t,this.gl=this.renderer.gl,this.uuid=a(),this._globalParameters={unpackAlignment:4,flipY:!e,premultiplyAlpha:!1,shouldPremultiplyAlpha:h,floatingPoint:o,type:this.gl.UNSIGNED_BYTE,internalFormat:this.gl.RGBA,format:this.gl.RGBA},this.parameters={anisotropy:l,generateMipmap:c,wrapS:d||this.gl.CLAMP_TO_EDGE,wrapT:u||this.gl.CLAMP_TO_EDGE,minFilter:p||this.gl.LINEAR,magFilter:m||this.gl.LINEAR,_shouldUpdate:!0},this._initState(),this.sourceType=e?"fbo":"empty",this._useCache=!0,this._samplerName=r,this._sampler={isActive:!1,isTextureBound:!1,texture:this.gl.createTexture()},this._textureMatrix={matrix:new R,isActive:!1},this._size={width:1,height:1},this.scale=new E(1),this.scale.onChange((()=>this.resize())),this.offset=new E,this.offset.onChange((()=>this.resize())),this._loader=s,this._sourceLoaded=!1,this._uploaded=!1,this._willUpdate=!1,this.shouldUpdate=!1,this._forceUpdate=!1,this.userData={},this._canDraw=!1,i)return this._copyOnInit=!0,void(this._copiedFrom=i);this._copyOnInit=!1,this._initTexture()}_initState(){this._state={anisotropy:1,generateMipmap:!1,wrapS:null,wrapT:null,minFilter:null,magFilter:this.gl.LINEAR}}_initTexture(){this.gl.bindTexture(this.gl.TEXTURE_2D,this._sampler.texture),"empty"===this.sourceType&&(this._globalParameters.flipY=!1,this._updateGlobalTexParameters(),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array([0,0,0,255])),this._canDraw=!0)}_restoreFromTexture(){this._copyOnInit||this._initTexture(),this._parent&&(this._setTextureUniforms(),this._setSize()),this.copy(this._copiedFrom),this._canDraw=!0}_restoreContext(){if(this._canDraw=!1,this._sampler.texture=this.gl.createTexture(),this._sampler.isActive=!1,this._sampler.isTextureBound=!1,this._textureMatrix.isActive=!1,this._initState(),this._state.generateMipmap=!1,this.parameters._shouldUpdate=!0,this._copiedFrom){const t=this.renderer.nextRender.add((()=>{this._copiedFrom._canDraw&&(this._restoreFromTexture(),t.keep=!1)}),!0)}else this._initTexture(),this._parent&&this._setParent(),this.source&&(this.setSource(this.source),"image"===this.sourceType?this.renderer.cache.addTexture(this):this.needUpdate()),this._canDraw=!0}addParent(t){!t||"Plane"!==t.type&&"PingPongPlane"!==t.type&&"ShaderPass"!==t.type&&"RenderTarget"!==t.type?this.renderer.production||r(this.type+": cannot add texture as a child of ",t," because it is not a valid parent"):(this._parent=t,this.index=this._parent.textures.length,this._parent.textures.push(this),this._setParent())}_setParent(){if(this._sampler.name=this._samplerName||"uSampler"+this.index,this._textureMatrix.name=this._samplerName?this._samplerName+"Matrix":"uTextureMatrix"+this.index,this._parent._program){if(!this._parent._program.compiled)return void(this.renderer.production||r(this.type+": Unable to create the texture because the program is not valid"));if(this._setTextureUniforms(),this._copyOnInit){const t=this.renderer.nextRender.add((()=>{this._copiedFrom._canDraw&&this._copiedFrom._uploaded&&(this.copy(this._copiedFrom),t.keep=!1)}),!0);return}this.source?this._parent.loader&&this._parent.loader._addSourceToParent(this.source,this.sourceType):this._size={width:this._parent._boundingRect.document.width,height:this._parent._boundingRect.document.height},this._setSize()}else"RenderTarget"===this._parent.type&&(this._size={width:this._parent._size&&this._parent._size.width||this.renderer._boundingRect.width,height:this._parent._size&&this._parent._size.height||this.renderer._boundingRect.height},this._upload(),this._updateTexParameters(),this._canDraw=!0)}hasParent(){return!!this._parent}_setTextureUniforms(){const t=this._parent._program.activeUniforms;for(let e=0;e<t.textures.length;e++)if(t.textures[e]===this._sampler.name){this._sampler.isActive=!0,this.renderer.useProgram(this._parent._program),this._sampler.location=this.gl.getUniformLocation(this._parent._program.program,this._sampler.name);t.textureMatrices.find((t=>t===this._textureMatrix.name))&&(this._textureMatrix.isActive=!0,this._textureMatrix.location=this.gl.getUniformLocation(this._parent._program.program,this._textureMatrix.name)),this.gl.uniform1i(this._sampler.location,this.index)}}copy(t){t&&"Texture"===t.type?(this._globalParameters=Object.assign({},t._globalParameters),this._state=Object.assign({},t._state),this.parameters.generateMipmap=t.parameters.generateMipmap,this._state.generateMipmap=null,this._size=t._size,!this._sourceLoaded&&t._sourceLoaded&&this._onSourceLoadedCallback&&this._onSourceLoadedCallback(),this._sourceLoaded=t._sourceLoaded,!this._uploaded&&t._uploaded&&this._onSourceUploadedCallback&&this._onSourceUploadedCallback(),this._uploaded=t._uploaded,this.sourceType=t.sourceType,this.source=t.source,this._videoFrameCallbackID=t._videoFrameCallbackID,this._sampler.texture=t._sampler.texture,this._copiedFrom=t,!this._parent||!this._parent._program||this._canDraw&&this._textureMatrix.matrix||(this._setSize(),this._canDraw=!0),this._updateTexParameters(),this.renderer.needRender()):this.renderer.production||r(this.type+": Unable to set the texture from texture:",t)}setSource(t){this._sourceLoaded||this.renderer.nextRender.add((()=>this._onSourceLoadedCallback&&this._onSourceLoadedCallback()));const e="IMG"===t.tagName.toUpperCase()?"image":t.tagName.toLowerCase();if("video"!==e&&"canvas"!==e||(this._useCache=!1),this._useCache){const e=this.renderer.cache.getTextureFromSource(t);if(e&&e.uuid!==this.uuid)return this._uploaded||(this.renderer.nextRender.add((()=>this._onSourceUploadedCallback&&this._onSourceUploadedCallback())),this._uploaded=!0),this.copy(e),void this.resize()}if("empty"===this.sourceType||this.sourceType!==e)if("video"===e)this._willUpdate=!1,this.shouldUpdate=!0;else if("canvas"===e)this._willUpdate=!0,this.shouldUpdate=!0;else{if("image"!==e)return void(this.renderer.production||r(this.type+": this HTML tag could not be converted into a texture:",t.tagName));this._willUpdate=!1,this.shouldUpdate=!1}this.source=t,this.sourceType=e,this._size={width:this.source.naturalWidth||this.source.width||this.source.videoWidth,height:this.source.naturalHeight||this.source.height||this.source.videoHeight},this._sourceLoaded=!0,this.gl.bindTexture(this.gl.TEXTURE_2D,this._sampler.texture),this.resize(),this._globalParameters.flipY=!0,this._globalParameters.premultiplyAlpha=this._globalParameters.shouldPremultiplyAlpha,"image"===this.sourceType&&(this.parameters.generateMipmap=this.parameters.generateMipmap||null===this.parameters.generateMipmap,this.parameters._shouldUpdate=this.parameters.generateMipmap,this._state.generateMipmap=!1,this._upload()),this.renderer.needRender()}_updateGlobalTexParameters(){this.renderer.state.unpackAlignment!==this._globalParameters.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this._globalParameters.unpackAlignment),this.renderer.state.unpackAlignment=this._globalParameters.unpackAlignment),this.renderer.state.flipY!==this._globalParameters.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this._globalParameters.flipY),this.renderer.state.flipY=this._globalParameters.flipY),this.renderer.state.premultiplyAlpha!==this._globalParameters.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._globalParameters.premultiplyAlpha),this.renderer.state.premultiplyAlpha=this._globalParameters.premultiplyAlpha),"half-float"===this._globalParameters.floatingPoint?this.renderer._isWebGL2&&this.renderer.extensions.EXT_color_buffer_float?(this._globalParameters.internalFormat=this.gl.RGBA16F,this._globalParameters.type=this.gl.HALF_FLOAT):this.renderer.extensions.OES_texture_half_float?this._globalParameters.type=this.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES:this.renderer.production||r(this.type+": could not use half-float textures because the extension is not available"):"float"===this._globalParameters.floatingPoint&&(this.renderer._isWebGL2&&this.renderer.extensions.EXT_color_buffer_float?(this._globalParameters.internalFormat=this.gl.RGBA16F,this._globalParameters.type=this.gl.FLOAT):this.renderer.extensions.OES_texture_float?this._globalParameters.type=this.renderer.extensions.OES_texture_half_float.FLOAT:this.renderer.production||r(this.type+": could not use float textures because the extension is not available"))}_updateTexParameters(){this.index&&this.renderer.state.activeTexture!==this.index&&this._bindTexture(),this.parameters.wrapS!==this._state.wrapS&&(this.renderer._isWebGL2||o(this._size.width)&&o(this._size.height)||(this.parameters.wrapS=this.gl.CLAMP_TO_EDGE),this.parameters.wrapS!==this.gl.REPEAT&&this.parameters.wrapS!==this.gl.CLAMP_TO_EDGE&&this.parameters.wrapS!==this.gl.MIRRORED_REPEAT&&(this.renderer.production||r(this.type+": Wrong wrapS value",this.parameters.wrapS,"for this texture:",this,"\ngl.CLAMP_TO_EDGE wrapping will be used instead"),this.parameters.wrapS=this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.parameters.wrapS),this._state.wrapS=this.parameters.wrapS),this.parameters.wrapT!==this._state.wrapT&&(this.renderer._isWebGL2||o(this._size.width)&&o(this._size.height)||(this.parameters.wrapT=this.gl.CLAMP_TO_EDGE),this.parameters.wrapT!==this.gl.REPEAT&&this.parameters.wrapT!==this.gl.CLAMP_TO_EDGE&&this.parameters.wrapT!==this.gl.MIRRORED_REPEAT&&(this.renderer.production||r(this.type+": Wrong wrapT value",this.parameters.wrapT,"for this texture:",this,"\ngl.CLAMP_TO_EDGE wrapping will be used instead"),this.parameters.wrapT=this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.parameters.wrapT),this._state.wrapT=this.parameters.wrapT),this.parameters.generateMipmap&&!this._state.generateMipmap&&this.source&&(this.renderer._isWebGL2||o(this._size.width)&&o(this._size.height)?this.gl.generateMipmap(this.gl.TEXTURE_2D):this.parameters.generateMipmap=!1,this._state.generateMipmap=this.parameters.generateMipmap),this.parameters.minFilter!==this._state.minFilter&&(this.renderer._isWebGL2||o(this._size.width)&&o(this._size.height)||(this.parameters.minFilter=this.gl.LINEAR),this.parameters.generateMipmap||null===this.parameters.generateMipmap||(this.parameters.minFilter=this.gl.LINEAR),this.parameters.minFilter!==this.gl.LINEAR&&this.parameters.minFilter!==this.gl.NEAREST&&this.parameters.minFilter!==this.gl.NEAREST_MIPMAP_NEAREST&&this.parameters.minFilter!==this.gl.LINEAR_MIPMAP_NEAREST&&this.parameters.minFilter!==this.gl.NEAREST_MIPMAP_LINEAR&&this.parameters.minFilter!==this.gl.LINEAR_MIPMAP_LINEAR&&(this.renderer.production||r(this.type+": Wrong minFilter value",this.parameters.minFilter,"for this texture:",this,"\ngl.LINEAR filtering will be used instead"),this.parameters.minFilter=this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.parameters.minFilter),this._state.minFilter=this.parameters.minFilter),this.parameters.magFilter!==this._state.magFilter&&(this.renderer._isWebGL2||o(this._size.width)&&o(this._size.height)||(this.parameters.magFilter=this.gl.LINEAR),this.parameters.magFilter!==this.gl.LINEAR&&this.parameters.magFilter!==this.gl.NEAREST&&(this.renderer.production||r(this.type+": Wrong magFilter value",this.parameters.magFilter,"for this texture:",this,"\ngl.LINEAR filtering will be used instead"),this.parameters.magFilter=this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.parameters.magFilter),this._state.magFilter=this.parameters.magFilter);const t=this.renderer.extensions.EXT_texture_filter_anisotropic;if(t&&this.parameters.anisotropy!==this._state.anisotropy){const e=this.gl.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.parameters.anisotropy=Math.max(1,Math.min(this.parameters.anisotropy,e)),this.gl.texParameterf(this.gl.TEXTURE_2D,t.TEXTURE_MAX_ANISOTROPY_EXT,this.parameters.anisotropy),this._state.anisotropy=this.parameters.anisotropy}}setWrapS(t){this.parameters.wrapS!==t&&(this.parameters.wrapS=t,this.parameters._shouldUpdate=!0)}setWrapT(t){this.parameters.wrapT!==t&&(this.parameters.wrapT=t,this.parameters._shouldUpdate=!0)}setMinFilter(t){this.parameters.minFilter!==t&&(this.parameters.minFilter=t,this.parameters._shouldUpdate=!0)}setMagFilter(t){this.parameters.magFilter!==t&&(this.parameters.magFilter=t,this.parameters._shouldUpdate=!0)}setAnisotropy(t){t=isNaN(t)?this.parameters.anisotropy:t,this.parameters.anisotropy!==t&&(this.parameters.anisotropy=t,this.parameters._shouldUpdate=!0)}needUpdate(){this._forceUpdate=!0}_videoFrameCallback(){this._willUpdate=!0,this.source.requestVideoFrameCallback((()=>this._videoFrameCallback()))}_upload(){this._updateGlobalTexParameters(),this.source?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this._globalParameters.internalFormat,this._globalParameters.format,this._globalParameters.type,this.source):"fbo"===this.sourceType&&this.gl.texImage2D(this.gl.TEXTURE_2D,0,this._globalParameters.internalFormat,this._size.width,this._size.height,0,this._globalParameters.format,this._globalParameters.type,this.source||null),this._uploaded||(this.renderer.nextRender.add((()=>this._onSourceUploadedCallback&&this._onSourceUploadedCallback())),this._uploaded=!0)}_getSizes(){if("fbo"===this.sourceType)return{parentWidth:this._parent._boundingRect.document.width,parentHeight:this._parent._boundingRect.document.height,sourceWidth:this._parent._boundingRect.document.width,sourceHeight:this._parent._boundingRect.document.height,xOffset:0,yOffset:0};const t=this._parent.scale?k.set(this._parent.scale.x,this._parent.scale.y):k.set(1,1),e=this._parent._boundingRect.document.width*t.x,i=this._parent._boundingRect.document.height*t.y,s=this._size.width,r=this._size.height,n=s/r,a=e/i;let o=0,h=0;return a>n?h=Math.min(0,i-e*(1/n)):a<n&&(o=Math.min(0,e-i*n)),{parentWidth:e,parentHeight:i,sourceWidth:s,sourceHeight:r,xOffset:o,yOffset:h}}setScale(t){t.type&&"Vec2"===t.type?(t.sanitizeNaNValuesWith(this.scale).max(k.set(.001,.001)),t.equals(this.scale)||(this.scale.copy(t),this.resize())):this.renderer.production||r(this.type+": Cannot set scale because the parameter passed is not of Vec2 type:",t)}setOffset(t){t.type&&"Vec2"===t.type?(t.sanitizeNaNValuesWith(this.offset),t.equals(this.offset)||(this.offset.copy(t),this.resize())):this.renderer.production||r(this.type+": Cannot set offset because the parameter passed is not of Vec2 type:",scale)}_setSize(){if(this._parent&&this._parent._program){const t=this._getSizes();this._updateTextureMatrix(t)}}resize(){"fbo"===this.sourceType?(this._size={width:this._parent._size&&this._parent._size.width||this._parent._boundingRect.document.width,height:this._parent._size&&this._parent._size.height||this._parent._boundingRect.document.height},this._copiedFrom||(this.gl.bindTexture(this.gl.TEXTURE_2D,this._sampler.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this._globalParameters.internalFormat,this._size.width,this._size.height,0,this._globalParameters.format,this._globalParameters.type,null))):this.source&&(this._size={width:this.source.naturalWidth||this.source.width||this.source.videoWidth,height:this.source.naturalHeight||this.source.height||this.source.videoHeight}),this._setSize()}_updateTextureMatrix(t){const e=C.set(t.parentWidth/(t.parentWidth-t.xOffset),t.parentHeight/(t.parentHeight-t.yOffset),1);e.x/=this.scale.x,e.y/=this.scale.y,this._textureMatrix.matrix=A.setFromArray([e.x,0,0,0,0,e.y,0,0,0,0,1,0,(1-e.x)/2+this.offset.x,(1-e.y)/2+this.offset.y,0,1]),this._updateMatrixUniform()}_updateMatrixUniform(){this._textureMatrix.isActive&&(this.renderer.useProgram(this._parent._program),this.gl.uniformMatrix4fv(this._textureMatrix.location,!1,this._textureMatrix.matrix.elements))}_onSourceLoaded(t){this.setSource(t),"image"===this.sourceType&&this.renderer.cache.addTexture(this)}_bindTexture(){this._canDraw&&(this.renderer.state.activeTexture!==this.index&&(this.gl.activeTexture(this.gl.TEXTURE0+this.index),this.renderer.state.activeTexture=this.index),this.gl.bindTexture(this.gl.TEXTURE_2D,this._sampler.texture),this._sampler.isTextureBound||(this._sampler.isTextureBound=!!this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._sampler.isTextureBound&&this.renderer.needRender()))}_draw(){this._sampler.isActive&&(this._bindTexture(),"video"===this.sourceType&&this.source&&!this._videoFrameCallbackID&&this.source.readyState>=this.source.HAVE_CURRENT_DATA&&!this.source.paused&&(this._willUpdate=!0),(this._forceUpdate||this._willUpdate&&this.shouldUpdate)&&(this._state.generateMipmap=!1,this._upload()),"video"===this.sourceType&&(this._willUpdate=!1),this._forceUpdate=!1),this.parameters._shouldUpdate&&(this._updateTexParameters(),this.parameters._shouldUpdate=!1)}onSourceLoaded(t){return t&&(this._onSourceLoadedCallback=t),this}onSourceUploaded(t){return t&&(this._onSourceUploadedCallback=t),this}_dispose(t=!1){"video"===this.sourceType||"image"===this.sourceType&&!this.renderer.state.isActive?(this._loader&&this._loader._removeSource(this),this.source=null):"canvas"===this.sourceType&&(this.source.width=this.source.width,this.source=null),this._parent=null;this.gl&&!this._copiedFrom&&(t||"image"!==this.sourceType||!this.renderer.state.isActive)&&(this._canDraw=!1,this.renderer.cache.removeTexture(this),this.gl.activeTexture(this.gl.TEXTURE0+this.index),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.deleteTexture(this._sampler.texture))}}class O{constructor(t,e="anonymous"){if(this.type="TextureLoader",(t=t&&t.renderer||t)&&"Renderer"===t.type){if(!t.gl)return void n(this.type+": Renderer WebGL context is undefined",t)}else n(this.type+": Renderer not passed as first argument",t);this.renderer=t,this.gl=this.renderer.gl,this.crossOrigin=e,this.elements=[]}_addElement(t,e,i,s){const r={source:t,texture:e,load:this._sourceLoaded.bind(this,t,e,i),error:this._sourceLoadError.bind(this,t,s)};return this.elements.push(r),r}_sourceLoadError(t,e,i){e&&e(t,i)}_sourceLoaded(t,e,i){e._sourceLoaded||(e._onSourceLoaded(t),this._parent&&(this._increment&&this._increment(),this.renderer.nextRender.add((()=>this._parent._onLoadingCallback&&this._parent._onLoadingCallback(e)))),i&&i(e))}_getSourceType(t){let e;return"string"==typeof t?null!==t.match(/\.(jpeg|jpg|jfif|pjpeg|pjp|gif|bmp|png|webp|svg|avif|apng)$/)?e="image":null!==t.match(/\.(webm|mp4|mpg|mpeg|avi|ogg|ogm|ogv|mov|av1)$/)&&(e="video"):"IMG"===t.tagName.toUpperCase()?e="image":"VIDEO"===t.tagName.toUpperCase()?e="video":"CANVAS"===t.tagName.toUpperCase()&&(e="canvas"),e}_createImage(t){if("string"!=typeof t&&t.hasAttribute("crossOrigin"))return t;{const e=new Image;return e.crossOrigin=this.crossOrigin,"string"==typeof t?e.src=t:(e.src=t.src,t.hasAttribute("data-sampler")&&e.setAttribute("data-sampler",t.getAttribute("data-sampler"))),e}}_createVideo(t){if("string"==typeof t||null===t.getAttribute("crossOrigin")){const e=document.createElement("video");return e.crossOrigin=this.crossOrigin,"string"==typeof t?e.src=t:(e.src=t.src,t.hasAttribute("data-sampler")&&e.setAttribute("data-sampler",t.getAttribute("data-sampler"))),e}return t}loadSource(t,e,i,s){switch(this._getSourceType(t)){case"image":this.loadImage(t,e,i,s);break;case"video":this.loadVideo(t,e,i,s);break;case"canvas":this.loadCanvas(t,e,i);break;default:this._sourceLoadError(t,s,"this source could not be converted into a texture: "+t)}}loadSources(t,e,i,s){for(let r=0;r<t.length;r++)this.loadSource(t[r],e,i,s)}loadImage(t,e={},i,s){const r=this.renderer.cache.getTextureFromSource(t);let n=Object.assign({},e);if(this._parent&&(n=Object.assign(n,this._parent._texturesOptions)),n.loader=this,r){n.sampler="string"!=typeof t&&t.hasAttribute("data-sampler")?t.getAttribute("data-sampler"):n.sampler,n.fromTexture=r;const e=new M(this.renderer,n);return this._sourceLoaded(r.source,e,i),void(this._parent&&this._addToParent(e,r.source,"image"))}const a=this._createImage(t);n.sampler=a.hasAttribute("data-sampler")?a.getAttribute("data-sampler"):n.sampler;const o=new M(this.renderer,n),h=this._addElement(a,o,i,s);a.complete?this._sourceLoaded(a,o,i):a.decode?a.decode().then(this._sourceLoaded.bind(this,a,o,i)).catch((()=>{a.addEventListener("load",h.load,!1),a.addEventListener("error",h.error,!1)})):(a.addEventListener("load",h.load,!1),a.addEventListener("error",h.error,!1)),this._parent&&this._addToParent(o,a,"image")}loadImages(t,e,i,s){for(let r=0;r<t.length;r++)this.loadImage(t[r],e,i,s)}loadVideo(t,e={},i,s){const r=this._createVideo(t);r.preload=!0,r.muted=!0,r.loop=!0,r.setAttribute("playsinline",""),r.crossOrigin=this.crossOrigin;let n=Object.assign({},e);this._parent&&(n=Object.assign(e,this._parent._texturesOptions)),n.loader=this,n.sampler=r.hasAttribute("data-sampler")?r.getAttribute("data-sampler"):n.sampler;const a=new M(this.renderer,n),o=this._addElement(r,a,i,s);r.addEventListener("canplaythrough",o.load,!1),r.addEventListener("error",o.error,!1),r.readyState>=r.HAVE_FUTURE_DATA&&i&&this._sourceLoaded(r,a,i),r.load(),this._addToParent&&this._addToParent(a,r,"video"),"requestVideoFrameCallback"in HTMLVideoElement.prototype&&(o.videoFrameCallback=a._videoFrameCallback.bind(a),a._videoFrameCallbackID=r.requestVideoFrameCallback(o.videoFrameCallback))}loadVideos(t,e,i,s){for(let r=0;r<t.length;r++)this.loadVideo(t[r],e,i,s)}loadCanvas(t,e={},i){let s=Object.assign({},e);this._parent&&(s=Object.assign(e,this._parent._texturesOptions)),s.loader=this,s.sampler=t.hasAttribute("data-sampler")?t.getAttribute("data-sampler"):s.sampler;const r=new M(this.renderer,s);this._addElement(t,r,i,null),this._sourceLoaded(t,r,i),this._parent&&this._addToParent(r,t,"canvas")}loadCanvases(t,e,i){for(let s=0;s<t.length;s++)this.loadCanvas(t[s],e,i)}_removeSource(t){const e=this.elements.find((e=>e.texture.uuid===t.uuid));e&&("image"===t.sourceType?e.source.removeEventListener("load",e.load,!1):"video"===t.sourceType&&(e.videoFrameCallback&&t._videoFrameCallbackID&&e.source.cancelVideoFrameCallback(t._videoFrameCallbackID),e.source.removeEventListener("canplaythrough",e.load,!1),e.source.pause(),e.source.removeAttribute("src"),e.source.load()),e.source.removeEventListener("error",e.error,!1))}}class L extends O{constructor(t,e,{sourcesLoaded:i=0,sourcesToLoad:s=0,complete:n=!1,onComplete:a=(()=>{})}={}){super(t,e.crossOrigin),this.type="PlaneTextureLoader",this._parent=e,"Plane"!==this._parent.type&&"PingPongPlane"!==this._parent.type&&"ShaderPass"!==this._parent.type&&(r(this.type+": Wrong parent type assigned to this loader"),this._parent=null),this.sourcesLoaded=i,this.sourcesToLoad=s,this.complete=n,this.onComplete=a}_setLoaderSize(t){this.sourcesToLoad=t,0===this.sourcesToLoad&&(this.complete=!0,this.renderer.nextRender.add((()=>this.onComplete&&this.onComplete())))}_increment(){this.sourcesLoaded++,this.sourcesLoaded>=this.sourcesToLoad&&!this.complete&&(this.complete=!0,this.renderer.nextRender.add((()=>this.onComplete&&this.onComplete())))}_addSourceToParent(t,e){if("image"===e){const e=this._parent.images;!e.find((e=>e.src===t.src))&&e.push(t)}else if("video"===e){const e=this._parent.videos;!e.find((e=>e.src===t.src))&&e.push(t)}else if("canvas"===e){const e=this._parent.canvases;!e.find((e=>e.isSameNode(t)))&&e.push(t)}}_addToParent(t,e,i){this._addSourceToParent(e,i),this._parent&&t.addParent(this._parent)}}class D{constructor(t,e="Mesh",{vertexShaderID:i,fragmentShaderID:s,vertexShader:r,fragmentShader:a,uniforms:o={},widthSegments:h=1,heightSegments:l=1,renderOrder:c=0,depthTest:d=!0,cullFace:u="back",texturesOptions:p={},crossOrigin:m="anonymous"}={}){if(this.type=e,(t=t&&t.renderer||t)&&"Renderer"===t.type||(n(this.type+": Curtains not passed as first argument or Curtains Renderer is missing",t),setTimeout((()=>{this._onErrorCallback&&this._onErrorCallback()}),0)),this.renderer=t,this.gl=this.renderer.gl,!this.gl)return this.renderer.production||n(this.type+": Unable to create a "+this.type+" because the Renderer WebGL context is not defined"),void setTimeout((()=>{this._onErrorCallback&&this._onErrorCallback()}),0);this._canDraw=!1,this.renderOrder=c,this._depthTest=d,this.cullFace=u,"back"!==this.cullFace&&"front"!==this.cullFace&&"none"!==this.cullFace&&(this.cullFace="back"),this.textures=[],this._texturesOptions=Object.assign({premultiplyAlpha:!1,anisotropy:1,floatingPoint:"none",wrapS:this.gl.CLAMP_TO_EDGE,wrapT:this.gl.CLAMP_TO_EDGE,minFilter:this.gl.LINEAR,magFilter:this.gl.LINEAR},p),this.crossOrigin=m,!r&&i&&document.getElementById(i)&&(r=document.getElementById(i).innerHTML),!a&&s&&document.getElementById(s)&&(a=document.getElementById(s).innerHTML),this._initMesh(),h=parseInt(h),l=parseInt(l),this._geometry=new T(this.renderer,{width:h,height:l}),this._program=new S(this.renderer,{parent:this,vertexShader:r,fragmentShader:a}),this._program.compiled?(this._program.createUniforms(o),this.uniforms=this._program.uniformsManager.uniforms,this._geometry.setProgram(this._program),this.renderer.onSceneChange()):this.renderer.nextRender.add((()=>this._onErrorCallback&&this._onErrorCallback()))}_initMesh(){this.uuid=a(),this.loader=new L(this.renderer,this,{sourcesLoaded:0,initSourcesToLoad:0,complete:!1,onComplete:()=>{this._onReadyCallback&&this._onReadyCallback(),this.renderer.needRender()}}),this.images=[],this.videos=[],this.canvases=[],this.userData={},this._canDraw=!0}_restoreContext(){this._canDraw=!1,this._matrices&&(this._matrices=null),this._program=new S(this.renderer,{parent:this,vertexShader:this._program.vsCode,fragmentShader:this._program.fsCode}),this._program.compiled&&(this._geometry.restoreContext(this._program),this._program.createUniforms(this.uniforms),this.uniforms=this._program.uniformsManager.uniforms,this._programRestored())}setRenderTarget(t){t&&"RenderTarget"===t.type?("Plane"===this.type&&this.renderer.scene.removePlane(this),this.target=t,"Plane"===this.type&&this.renderer.scene.addPlane(this)):this.renderer.production||r(this.type+": Could not set the render target because the argument passed is not a RenderTarget class object",t)}setRenderOrder(t=0){(t=isNaN(t)?this.renderOrder:parseInt(t))!==this.renderOrder&&(this.renderOrder=t,this.renderer.scene.setPlaneRenderOrder(this))}createTexture(t={}){const e=new M(this.renderer,Object.assign(t,this._texturesOptions));return e.addParent(this),e}addTexture(t){t&&"Texture"===t.type?t.addParent(this):this.renderer.production||r(this.type+": cannot add ",t," to this "+this.type+" because it is not a valid texture")}loadSources(t,e={},i,s){for(let r=0;r<t.length;r++)this.loadSource(t[r],e,i,s)}loadSource(t,e={},i,s){this.loader.loadSource(t,Object.assign(e,this._texturesOptions),(t=>{i&&i(t)}),((t,e)=>{this.renderer.production||r(this.type+": this HTML tag could not be converted into a texture:",t.tagName),s&&s(t,e)}))}loadImage(t,e={},i,s){this.loader.loadImage(t,Object.assign(e,this._texturesOptions),(t=>{i&&i(t)}),((t,e)=>{this.renderer.production||r(this.type+": There has been an error:\n",e,"\nwhile loading this image:\n",t),s&&s(t,e)}))}loadVideo(t,e={},i,s){this.loader.loadVideo(t,Object.assign(e,this._texturesOptions),(t=>{i&&i(t)}),((t,e)=>{this.renderer.production||r(this.type+": There has been an error:\n",e,"\nwhile loading this video:\n",t),s&&s(t,e)}))}loadCanvas(t,e={},i){this.loader.loadCanvas(t,Object.assign(e,this._texturesOptions),(t=>{i&&i(t)}))}loadImages(t,e={},i,s){for(let r=0;r<t.length;r++)this.loadImage(t[r],e,i,s)}loadVideos(t,e={},i,s){for(let r=0;r<t.length;r++)this.loadVideo(t[r],e,i,s)}loadCanvases(t,e={},i){for(let s=0;s<t.length;s++)this.loadCanvas(t[s],e,i)}playVideos(){for(let t=0;t<this.textures.length;t++){const e=this.textures[t];if("video"===e.sourceType){const t=e.source.play();void 0!==t&&t.catch((t=>{this.renderer.production||r(this.type+": Could not play the video : ",t)}))}}}_draw(){this.renderer.setDepthTest(this._depthTest),this.renderer.setFaceCulling(this.cullFace),this._program.updateUniforms(),this._geometry.bindBuffers(),this.renderer.state.forceBufferUpdate=!1;for(let t=0;t<this.textures.length;t++)if(this.textures[t]._draw(),this.textures[t]._sampler.isActive&&!this.textures[t]._sampler.isTextureBound)return;this._geometry.draw(),this.renderer.state.activeTexture=null,this._onAfterRenderCallback&&this._onAfterRenderCallback()}onError(t){return t&&(this._onErrorCallback=t),this}onLoading(t){return t&&(this._onLoadingCallback=t),this}onReady(t){return t&&(this._onReadyCallback=t),this}onRender(t){return t&&(this._onRenderCallback=t),this}onAfterRender(t){return t&&(this._onAfterRenderCallback=t),this}remove(){this._canDraw=!1,this.target&&this.renderer.bindFrameBuffer(null),this._dispose(),"Plane"===this.type?this.renderer.removePlane(this):"ShaderPass"===this.type&&(this.target&&(this.target._shaderPass=null,this.target.remove(),this.target=null),this.renderer.removeShaderPass(this))}_dispose(){if(this.gl){this._geometry&&this._geometry.dispose(),this.target&&"ShaderPass"===this.type&&(this.renderer.removeRenderTarget(this.target),this.textures.shift());for(let t=0;t<this.textures.length;t++)this.textures[t]._dispose();this.textures=[]}}}const F=new E,z=new E;class I extends D{constructor(t,e,i="DOMMesh",{widthSegments:s,heightSegments:n,renderOrder:a,depthTest:o,cullFace:h,uniforms:l,vertexShaderID:c,fragmentShaderID:d,vertexShader:u,fragmentShader:p,texturesOptions:m,crossOrigin:g}={}){super(t,i,{widthSegments:s,heightSegments:n,renderOrder:a,depthTest:o,cullFace:h,uniforms:l,vertexShaderID:c=c||e&&e.getAttribute("data-vs-id"),fragmentShaderID:d=d||e&&e.getAttribute("data-fs-id"),vertexShader:u,fragmentShader:p,texturesOptions:m,crossOrigin:g}),this.gl&&(this.htmlElement=e,this.htmlElement&&0!==this.htmlElement.length||this.renderer.production||r(this.type+": The HTML element you specified does not currently exists in the DOM"),this._setDocumentSizes())}_setDocumentSizes(){let t=this.htmlElement.getBoundingClientRect();this._boundingRect||(this._boundingRect={}),this._boundingRect.document={width:t.width*this.renderer.pixelRatio,height:t.height*this.renderer.pixelRatio,top:t.top*this.renderer.pixelRatio,left:t.left*this.renderer.pixelRatio}}getBoundingRect(){return{width:this._boundingRect.document.width,height:this._boundingRect.document.height,top:this._boundingRect.document.top,left:this._boundingRect.document.left,right:this._boundingRect.document.left+this._boundingRect.document.width,bottom:this._boundingRect.document.top+this._boundingRect.document.height}}resize(){this._setDocumentSizes(),"Plane"===this.type&&(this.setPerspective(this.camera.fov,this.camera.near,this.camera.far),this._setWorldSizes(),this._applyWorldPositions());for(let t=0;t<this.textures.length;t++)this.textures[t].resize();this.renderer.nextRender.add((()=>this._onAfterResizeCallback&&this._onAfterResizeCallback()))}mouseToPlaneCoords(t){const e=this.scale?this.scale:z.set(1,1),i=F.set((this._boundingRect.document.width-this._boundingRect.document.width*e.x)/2,(this._boundingRect.document.height-this._boundingRect.document.height*e.y)/2),s=this._boundingRect.document.width*e.x/this.renderer.pixelRatio,r=this._boundingRect.document.height*e.y/this.renderer.pixelRatio,n=(this._boundingRect.document.top+i.y)/this.renderer.pixelRatio,a=(this._boundingRect.document.left+i.x)/this.renderer.pixelRatio;return F.set((t.x-a)/s*2-1,1-(t.y-n)/r*2)}onAfterResize(t){return t&&(this._onAfterResizeCallback=t),this}}class U{constructor({fov:t=50,near:e=.1,far:i=150,width:s,height:r,pixelRatio:n=1}={}){this.position=new P,this.projectionMatrix=new R,this.worldMatrix=new R,this.viewMatrix=new R,this._shouldUpdate=!1,this.setSize(),this.setPerspective(t,e,i,s,r,n)}setFov(t){t=isNaN(t)?this.fov:parseFloat(t),(t=Math.max(1,Math.min(t,179)))!==this.fov&&(this.fov=t,this.setPosition(),this._shouldUpdate=!0),this.setCSSPerspective()}setNear(t){t=isNaN(t)?this.near:parseFloat(t),(t=Math.max(t,.01))!==this.near&&(this.near=t,this._shouldUpdate=!0)}setFar(t){t=isNaN(t)?this.far:parseFloat(t),(t=Math.max(t,50))!==this.far&&(this.far=t,this._shouldUpdate=!0)}setPixelRatio(t){t!==this.pixelRatio&&(this._shouldUpdate=!0),this.pixelRatio=t}setSize(t,e){t===this.width&&e===this.height||(this._shouldUpdate=!0),this.width=t,this.height=e}setPerspective(t,e,i,s,r,n){this.setPixelRatio(n),this.setSize(s,r),this.setFov(t),this.setNear(e),this.setFar(i),this._shouldUpdate&&this.updateProjectionMatrix()}setPosition(){this.position.set(0,0,1),this.worldMatrix.setFromArray([1,0,0,0,0,1,0,0,0,0,1,0,this.position.x,this.position.y,this.position.z,1]),this.viewMatrix=this.viewMatrix.copy(this.worldMatrix).getInverse()}setCSSPerspective(){this.CSSPerspective=Math.pow(Math.pow(this.width/(2*this.pixelRatio),2)+Math.pow(this.height/(2*this.pixelRatio),2),.5)/Math.tan(.5*this.fov*Math.PI/180)}getScreenRatiosFromFov(t=0){const e=this.position.z;t<e?t-=e:t+=e;const i=this.fov*Math.PI/180,s=2*Math.tan(i/2)*Math.abs(t);return{width:s*this.width/this.height,height:s}}updateProjectionMatrix(){const t=this.width/this.height,e=this.near*Math.tan(Math.PI/180*.5*this.fov),i=2*e,s=t*i,r=-.5*s,n=r+s,a=e-i,o=2*this.near/(n-r),h=2*this.near/(e-a),l=(n+r)/(n-r),c=(e+a)/(e-a),d=-(this.far+this.near)/(this.far-this.near),u=-2*this.far*this.near/(this.far-this.near);this.projectionMatrix.setFromArray([o,0,0,0,0,h,0,0,l,c,d,-1,0,0,u,0])}forceUpdate(){this._shouldUpdate=!0}cancelUpdate(){this._shouldUpdate=!1}}class V{constructor(t=new Float32Array([0,0,0,1]),e="XYZ"){this.type="Quat",this.elements=t,this.axisOrder=e}setFromArray(t){return this.elements[0]=t[0],this.elements[1]=t[1],this.elements[2]=t[2],this.elements[3]=t[3],this}setAxisOrder(t){switch(t=t.toUpperCase()){case"XYZ":case"YXZ":case"ZXY":case"ZYX":case"YZX":case"XZY":this.axisOrder=t;break;default:this.axisOrder="XYZ"}return this}copy(t){return this.elements=t.elements,this.axisOrder=t.axisOrder,this}clone(){return(new V).copy(this)}equals(t){return this.elements[0]===t.elements[0]&&this.elements[1]===t.elements[1]&&this.elements[2]===t.elements[2]&&this.elements[3]===t.elements[3]&&this.axisOrder===t.axisOrder}setFromVec3(t){const e=.5*t.x,i=.5*t.y,s=.5*t.z,r=Math.cos(e),n=Math.cos(i),a=Math.cos(s),o=Math.sin(e),h=Math.sin(i),l=Math.sin(s);return"XYZ"===this.axisOrder?(this.elements[0]=o*n*a+r*h*l,this.elements[1]=r*h*a-o*n*l,this.elements[2]=r*n*l+o*h*a,this.elements[3]=r*n*a-o*h*l):"YXZ"===this.axisOrder?(this.elements[0]=o*n*a+r*h*l,this.elements[1]=r*h*a-o*n*l,this.elements[2]=r*n*l-o*h*a,this.elements[3]=r*n*a+o*h*l):"ZXY"===this.axisOrder?(this.elements[0]=o*n*a-r*h*l,this.elements[1]=r*h*a+o*n*l,this.elements[2]=r*n*l+o*h*a,this.elements[3]=r*n*a-o*h*l):"ZYX"===this.axisOrder?(this.elements[0]=o*n*a-r*h*l,this.elements[1]=r*h*a+o*n*l,this.elements[2]=r*n*l-o*h*a,this.elements[3]=r*n*a+o*h*l):"YZX"===this.axisOrder?(this.elements[0]=o*n*a+r*h*l,this.elements[1]=r*h*a+o*n*l,this.elements[2]=r*n*l-o*h*a,this.elements[3]=r*n*a-o*h*l):"XZY"===this.axisOrder&&(this.elements[0]=o*n*a-r*h*l,this.elements[1]=r*h*a-o*n*l,this.elements[2]=r*n*l+o*h*a,this.elements[3]=r*n*a+o*h*l),this}}const B=new E,W=new P,N=new P,j=new P,H=new P,X=new P,Y=new P,G=new P,q=new P,K=new V,Z=new P(.5,.5,0),Q=new P,$=new P,J=new P,tt=new P,et=new E;class it extends I{constructor(t,e,{widthSegments:i,heightSegments:s,renderOrder:r,depthTest:n,cullFace:a,uniforms:o,vertexShaderID:h,fragmentShaderID:l,vertexShader:c,fragmentShader:d,texturesOptions:u,crossOrigin:p,alwaysDraw:m=!1,visible:g=!0,transparent:f=!1,drawCheckMargins:_={top:0,right:0,bottom:0,left:0},autoloadSources:y=!0,watchScroll:v=!0,fov:x=50}={}){super(t,e,"Plane",{widthSegments:i,heightSegments:s,renderOrder:r,depthTest:n,cullFace:a,uniforms:o,vertexShaderID:h,fragmentShaderID:l,vertexShader:c,fragmentShader:d,texturesOptions:u,crossOrigin:p}),this.gl&&(this.index=this.renderer.planes.length,this.target=null,this.alwaysDraw=m,this._shouldDraw=!0,this.visible=g,this._transparent=f,this.drawCheckMargins=_,this.autoloadSources=y,this.watchScroll=v,this._updateMVMatrix=!1,this.camera=new U({fov:x,width:this.renderer._boundingRect.width,height:this.renderer._boundingRect.height,pixelRatio:this.renderer.pixelRatio}),this._program.compiled&&(this._initPlane(),this.renderer.scene.addPlane(this),this.renderer.planes.push(this)))}_programRestored(){this.target&&this.setRenderTarget(this.renderer.renderTargets[this.target.index]),this._initMatrices(),this.setPerspective(this.camera.fov,this.camera.near,this.camera.far),this._setWorldSizes(),this._applyWorldPositions(),this.renderer.scene.addPlane(this);for(let t=0;t<this.textures.length;t++)this.textures[t]._parent=this,this.textures[t]._restoreContext();this._canDraw=!0}_initPlane(){this._initTransformValues(),this._initPositions(),this.setPerspective(this.camera.fov,this.camera.near,this.camera.far),this._initSources()}_initTransformValues(){this.rotation=new P,this.rotation.onChange((()=>this._applyRotation())),this.quaternion=new V,this.relativeTranslation=new P,this.relativeTranslation.onChange((()=>this._setTranslation())),this._translation=new P,this.scale=new P(1),this.scale.onChange((()=>{this.scale.z=1,this._applyScale()})),this.transformOrigin=new P(.5,.5,0),this.transformOrigin.onChange((()=>{this._setWorldTransformOrigin(),this._updateMVMatrix=!0}))}resetPlane(t){this._initTransformValues(),this._setWorldTransformOrigin(),null!==t&&t?(this.htmlElement=t,this.resize()):t||this.renderer.production||r(this.type+": You are trying to reset a plane with a HTML element that does not exist. The old HTML element will be kept instead.")}removeRenderTarget(){this.target&&(this.renderer.scene.removePlane(this),this.target=null,this.renderer.scene.addPlane(this))}_initPositions(){this._initMatrices(),this._setWorldSizes(),this._applyWorldPositions()}_initMatrices(){const t=new R;this._matrices={world:{matrix:t},modelView:{name:"uMVMatrix",matrix:t,location:this.gl.getUniformLocation(this._program.program,"uMVMatrix")},projection:{name:"uPMatrix",matrix:t,location:this.gl.getUniformLocation(this._program.program,"uPMatrix")},modelViewProjection:{matrix:t}}}_setPerspectiveMatrix(){this.camera._shouldUpdate&&(this.renderer.useProgram(this._program),this.gl.uniformMatrix4fv(this._matrices.projection.location,!1,this._matrices.projection.matrix.elements)),this.camera.cancelUpdate()}setPerspective(t,e,i){this.camera.setPerspective(t,e,i,this.renderer._boundingRect.width,this.renderer._boundingRect.height,this.renderer.pixelRatio),this.renderer.state.isContextLost&&this.camera.forceUpdate(),this._matrices.projection.matrix=this.camera.projectionMatrix,this.camera._shouldUpdate&&(this._setWorldSizes(),this._applyWorldPositions(),this._translation.z=this.relativeTranslation.z/this.camera.CSSPerspective),this._updateMVMatrix=this.camera._shouldUpdate}_setMVMatrix(){this._updateMVMatrix&&(this._matrices.world.matrix=this._matrices.world.matrix.composeFromOrigin(this._translation,this.quaternion,this.scale,this._boundingRect.world.transformOrigin),this._matrices.world.matrix.scale({x:this._boundingRect.world.width,y:this._boundingRect.world.height,z:1}),this._matrices.modelView.matrix.copy(this._matrices.world.matrix),this._matrices.modelView.matrix.elements[14]-=this.camera.position.z,this._matrices.modelViewProjection.matrix=this._matrices.projection.matrix.multiply(this._matrices.modelView.matrix),this.alwaysDraw||this._shouldDrawCheck(),this.renderer.useProgram(this._program),this.gl.uniformMatrix4fv(this._matrices.modelView.location,!1,this._matrices.modelView.matrix.elements)),this._updateMVMatrix=!1}_setWorldTransformOrigin(){this._boundingRect.world.transformOrigin=new P((2*this.transformOrigin.x-1)*this._boundingRect.world.width,-(2*this.transformOrigin.y-1)*this._boundingRect.world.height,this.transformOrigin.z)}_documentToWorldSpace(t){return N.set(t.x*this.renderer.pixelRatio/this.renderer._boundingRect.width*this._boundingRect.world.ratios.width,-t.y*this.renderer.pixelRatio/this.renderer._boundingRect.height*this._boundingRect.world.ratios.height,t.z)}_setWorldSizes(){const t=this.camera.getScreenRatiosFromFov();this._boundingRect.world={width:this._boundingRect.document.width/this.renderer._boundingRect.width*t.width/2,height:this._boundingRect.document.height/this.renderer._boundingRect.height*t.height/2,ratios:t},this._setWorldTransformOrigin()}_setWorldPosition(){const t=this._boundingRect.document.width/2+this._boundingRect.document.left,e=this._boundingRect.document.height/2+this._boundingRect.document.top,i=this.renderer._boundingRect.width/2+this.renderer._boundingRect.left,s=this.renderer._boundingRect.height/2+this.renderer._boundingRect.top;this._boundingRect.world.top=(s-e)/this.renderer._boundingRect.height*this._boundingRect.world.ratios.height,this._boundingRect.world.left=(t-i)/this.renderer._boundingRect.width*this._boundingRect.world.ratios.width}setScale(t){t.type&&"Vec2"===t.type?(t.sanitizeNaNValuesWith(this.scale).max(B.set(.001,.001)),t.x===this.scale.x&&t.y===this.scale.y||(this.scale.set(t.x,t.y,1),this._applyScale())):this.renderer.production||r(this.type+": Cannot set scale because the parameter passed is not of Vec2 type:",t)}_applyScale(){for(let t=0;t<this.textures.length;t++)this.textures[t].resize();this._updateMVMatrix=!0}setRotation(t){t.type&&"Vec3"===t.type?(t.sanitizeNaNValuesWith(this.rotation),t.equals(this.rotation)||(this.rotation.copy(t),this._applyRotation())):this.renderer.production||r(this.type+": Cannot set rotation because the parameter passed is not of Vec3 type:",t)}_applyRotation(){this.quaternion.setFromVec3(this.rotation),this._updateMVMatrix=!0}setTransformOrigin(t){t.type&&"Vec3"===t.type?(t.sanitizeNaNValuesWith(this.transformOrigin),t.equals(this.transformOrigin)||(this.transformOrigin.copy(t),this._setWorldTransformOrigin(),this._updateMVMatrix=!0)):this.renderer.production||r(this.type+": Cannot set transform origin because the parameter passed is not of Vec3 type:",t)}_setTranslation(){let t=W.set(0,0,0);this.relativeTranslation.equals(t)||(t=this._documentToWorldSpace(this.relativeTranslation)),this._translation.set(this._boundingRect.world.left+t.x,this._boundingRect.world.top+t.y,this.relativeTranslation.z/this.camera.CSSPerspective),this._updateMVMatrix=!0}setRelativeTranslation(t){t.type&&"Vec3"===t.type?(t.sanitizeNaNValuesWith(this.relativeTranslation),t.equals(this.relativeTranslation)||(this.relativeTranslation.copy(t),this._setTranslation())):this.renderer.production||r(this.type+": Cannot set translation because the parameter passed is not of Vec3 type:",t)}_applyWorldPositions(){this._setWorldPosition(),this._setTranslation()}updatePosition(){this._setDocumentSizes(),this._applyWorldPositions()}updateScrollPosition(t,e){(t||e)&&(this._boundingRect.document.top+=e*this.renderer.pixelRatio,this._boundingRect.document.left+=t*this.renderer.pixelRatio,this._applyWorldPositions())}_getIntersection(t,e){let i=e.clone().sub(t),s=t.clone();for(;s.z>-1;)s.add(i);return s}_getNearPlaneIntersections(t,e,i){const s=this._matrices.modelViewProjection.matrix;if(1===i.length)0===i[0]?(e[0]=this._getIntersection(e[1],G.set(.95,1,0).applyMat4(s)),e.push(this._getIntersection(e[3],q.set(-1,-.95,0).applyMat4(s)))):1===i[0]?(e[1]=this._getIntersection(e[0],G.set(-.95,1,0).applyMat4(s)),e.push(this._getIntersection(e[2],q.set(1,-.95,0).applyMat4(s)))):2===i[0]?(e[2]=this._getIntersection(e[3],G.set(-.95,-1,0).applyMat4(s)),e.push(this._getIntersection(e[1],q.set(1,.95,0).applyMat4(s)))):3===i[0]&&(e[3]=this._getIntersection(e[2],G.set(.95,-1,0).applyMat4(s)),e.push(this._getIntersection(e[0],q.set(-1,.95,0).applyMat4(s))));else if(2===i.length)0===i[0]&&1===i[1]?(e[0]=this._getIntersection(e[3],G.set(-1,-.95,0).applyMat4(s)),e[1]=this._getIntersection(e[2],q.set(1,-.95,0).applyMat4(s))):1===i[0]&&2===i[1]?(e[1]=this._getIntersection(e[0],G.set(-.95,1,0).applyMat4(s)),e[2]=this._getIntersection(e[3],q.set(-.95,-1,0).applyMat4(s))):2===i[0]&&3===i[1]?(e[2]=this._getIntersection(e[1],G.set(1,.95,0).applyMat4(s)),e[3]=this._getIntersection(e[0],q.set(-1,.95,0).applyMat4(s))):0===i[0]&&3===i[1]&&(e[0]=this._getIntersection(e[1],G.set(.95,1,0).applyMat4(s)),e[3]=this._getIntersection(e[2],q.set(.95,-1,0).applyMat4(s)));else if(3===i.length){let r=0;for(let e=0;e<t.length;e++)i.includes(e)||(r=e);e=[e[r]],0===r?(e.push(this._getIntersection(e[0],G.set(-.95,1,0).applyMat4(s))),e.push(this._getIntersection(e[0],q.set(-1,.95,0).applyMat4(s)))):1===r?(e.push(this._getIntersection(e[0],G.set(.95,1,0).applyMat4(s))),e.push(this._getIntersection(e[0],q.set(1,.95,0).applyMat4(s)))):2===r?(e.push(this._getIntersection(e[0],G.set(.95,-1,0).applyMat4(s))),e.push(this._getIntersection(e[0],q.set(1,-.95,0).applyMat4(s)))):3===r&&(e.push(this._getIntersection(e[0],G.set(-.95,-1,0).applyMat4(s))),e.push(this._getIntersection(e[0],q.set(-1.95,0).applyMat4(s))))}else for(let i=0;i<t.length;i++)e[i][0]=1e4,e[i][1]=1e4;return e}_getWorldCoords(){const t=[j.set(-1,1,0),H.set(1,1,0),X.set(1,-1,0),Y.set(-1,-1,0)];let e=[],i=[];for(let s=0;s<t.length;s++){const r=t[s].applyMat4(this._matrices.modelViewProjection.matrix);e.push(r),Math.abs(r.z)>1&&i.push(s)}i.length&&(e=this._getNearPlaneIntersections(t,e,i));let s=1/0,r=-1/0,n=1/0,a=-1/0;for(let t=0;t<e.length;t++){const i=e[t];i.x<s&&(s=i.x),i.x>r&&(r=i.x),i.y<n&&(n=i.y),i.y>a&&(a=i.y)}return{top:a,right:r,bottom:n,left:s}}_computeWebGLBoundingRect(){const t=this._getWorldCoords();let e={top:1-(t.top+1)/2,right:(t.right+1)/2,bottom:1-(t.bottom+1)/2,left:(t.left+1)/2};e.width=e.right-e.left,e.height=e.bottom-e.top,this._boundingRect.worldToDocument={width:e.width*this.renderer._boundingRect.width,height:e.height*this.renderer._boundingRect.height,top:e.top*this.renderer._boundingRect.height+this.renderer._boundingRect.top,left:e.left*this.renderer._boundingRect.width+this.renderer._boundingRect.left,right:e.left*this.renderer._boundingRect.width+this.renderer._boundingRect.left+e.width*this.renderer._boundingRect.width,bottom:e.top*this.renderer._boundingRect.height+this.renderer._boundingRect.top+e.height*this.renderer._boundingRect.height}}getWebGLBoundingRect(){return this._matrices.modelViewProjection?(this._boundingRect.worldToDocument&&!this.alwaysDraw||this._computeWebGLBoundingRect(),this._boundingRect.worldToDocument):this._boundingRect.document}_getWebGLDrawRect(){return this._computeWebGLBoundingRect(),{top:this._boundingRect.worldToDocument.top-this.drawCheckMargins.top,right:this._boundingRect.worldToDocument.right+this.drawCheckMargins.right,bottom:this._boundingRect.worldToDocument.bottom+this.drawCheckMargins.bottom,left:this._boundingRect.worldToDocument.left-this.drawCheckMargins.left}}_shouldDrawCheck(){const t=this._getWebGLDrawRect();Math.round(t.right)<=this.renderer._boundingRect.left||Math.round(t.left)>=this.renderer._boundingRect.left+this.renderer._boundingRect.width||Math.round(t.bottom)<=this.renderer._boundingRect.top||Math.round(t.top)>=this.renderer._boundingRect.top+this.renderer._boundingRect.height?this._shouldDraw&&(this._shouldDraw=!1,this.renderer.nextRender.add((()=>this._onLeaveViewCallback&&this._onLeaveViewCallback()))):(this._shouldDraw||this.renderer.nextRender.add((()=>this._onReEnterViewCallback&&this._onReEnterViewCallback())),this._shouldDraw=!0)}isDrawn(){return this._canDraw&&this.visible&&(this._shouldDraw||this.alwaysDraw)}enableDepthTest(t){this._depthTest=t}_initSources(){let t=0;if(this.autoloadSources){const e=this.htmlElement.getElementsByTagName("img"),i=this.htmlElement.getElementsByTagName("video"),s=this.htmlElement.getElementsByTagName("canvas");e.length&&this.loadImages(e),i.length&&this.loadVideos(i),s.length&&this.loadCanvases(s),t=e.length+i.length+s.length}this.loader._setLoaderSize(t),this._canDraw=!0}_startDrawing(){this._canDraw&&(this._onRenderCallback&&this._onRenderCallback(),this.target?this.renderer.bindFrameBuffer(this.target):null===this.renderer.state.scenePassIndex&&this.renderer.bindFrameBuffer(null),this._setPerspectiveMatrix(),this._setMVMatrix(),(this.alwaysDraw||this._shouldDraw)&&this.visible&&this._draw())}mouseToPlaneCoords(t){if(K.setAxisOrder(this.quaternion.axisOrder),K.equals(this.quaternion)&&Z.equals(this.transformOrigin))return super.mouseToPlaneCoords(t);{const e={x:t.x/(this.renderer._boundingRect.width/this.renderer.pixelRatio)*2-1,y:2*(1-t.y/(this.renderer._boundingRect.height/this.renderer.pixelRatio))-1},i=this.camera.position.clone(),s=Q.set(e.x,e.y,-.5);s.unproject(this.camera),s.sub(i).normalize();const r=$.set(0,0,-1);r.applyQuat(this.quaternion).normalize();const n=tt.set(0,0,0),a=r.dot(s);if(Math.abs(a)>=1e-4){const t=this._matrices.world.matrix.getInverse().multiply(this.camera.viewMatrix),e=this._boundingRect.world.transformOrigin.clone().add(this._translation),o=J.set(this._translation.x-e.x,this._translation.y-e.y,this._translation.z-e.z);o.applyQuat(this.quaternion),e.add(o);const h=r.dot(e.clone().sub(i))/a;n.copy(i.add(s.multiplyScalar(h))),n.applyMat4(t)}else n.set(1/0,1/0,1/0);return et.set(n.x,n.y)}}onReEnterView(t){return t&&(this._onReEnterViewCallback=t),this}onLeaveView(t){return t&&(this._onLeaveViewCallback=t),this}}}}]);